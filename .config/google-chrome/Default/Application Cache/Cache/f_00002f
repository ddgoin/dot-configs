Type.registerNamespace("_at");_at.$xg=function(n,t,i,r){_at.$xg.initializeBase(this);this.$5J=n;this.$20h=t;this.$1j=i;this.$Dy=r};_at.$xg.prototype={$20h:null,$1j:null,$Dy:null,$5J:null,$3bP:null,$7XB:function(n){var t=new _g.$xh(this.$28);n.$4o1(this.$5J,this.$20h,this.$1j,this.$Dy,t,this.$$d_$9K7,this.$$d_$9K8)},$8nZ:function(n,t,i){try{_a.$3.$1C(n,"result");this.$3bP=n;t()}catch(r){i(r)}}};function AttachmentsComponent(){}AttachmentsComponent.prototype={$1QB:function(n,t,i){var r=this;n.$9V(_at.$sP).$9Iz().$9J0(function(){return _at.$2K.get_$L()});var u=this;n.$9V(IAttachmentViewModelFactory).$9J0(function(){return new _at.$Jl(n.$9HY(IInferenceTracker),n.$5uT(_y.$N),n.$5uT(_at.$sP),n.$5uT(_a.$o),n.$5uT(_a.NativeBridge),n.$5uT(_y.$4p),n.$9HY(IAttachmentProviderItemViewModelFactory),n.$5uT(_a.$5X),n.$9HY(IAttachmentPreviewViewModelFactory),n.$9HY(IItemStoreGetterFactory),n.$5uT(IUriFileAttachmentViewModelFactory))});var f=this;n.$9V(_at.$vN).$9Iy(IUriFileAttachmentViewModelFactory).$9Iz().$9J0(function(){return new _at.$vN(n.$5uT(_a.$aA),n.$5uT(_a.$42),n.$9HY(IInferenceTracker),n.$5uT(_a.$5X),n.$9HY(IAttachmentPreviewViewModelFactory),n.$9HY(IItemStoreGetterFactory))})},$7Is:function(){return null}};_at.$3R=function(n){this.$$d_$3bU=Function.createDelegate(this,this.$3bU);this.$$d_$4va=Function.createDelegate(this,this.$4va);this.$$d_$9Fj=Function.createDelegate(this,this.$9Fj);this.$$d_$9Fk=Function.createDelegate(this,this.$9Fk);this.$$d_$7Qv=Function.createDelegate(this,this.$7Qv);this.$6r=0;_at.$3R.initializeBase(this,[n]);this.set_$EN("about:blank");this.set_$Y(-1);this.get_$J().load(this.$$d_$7Qv)};function $3DR(n,t,i,r){n.set_$4BS(t);n.set_$Qs(i);n.set_$2YY(r);n.$6r=3;n.get_$4FU().$s();n.$3Oy=!1}function $6EH(n){var t=n.get_$J()[0];t.contentWindow.document.body.innerHTML="";n.$rN=t.contentWindow.document.createElement("form");n.$rN.method="POST";n.$rN.encType="multipart/form-data";n.$rN.encoding="multipart/form-data";$6EG(n,n.$rN);n.$Ki=$(t.contentWindow.document.createElement("input"));n.$Ki.attr("type","file");n.$Ki.attr("name","fileInput");var i=this;n.$Ki.change(function(t){n.$3bU()});_a.UserAgent.getInstance().$8O&&n.$Ki[0].attachEvent("onchange",n.$$d_$3bU);n.$rN.appendChild(n.$Ki[0])}function $6EG(n,t){n.get_$J()[0].contentWindow.document.body.appendChild(t)}function $6EI(n,t){var i=t.lastIndexOf("\\");return t.substr(i+1)}function $4IF(n){_js.Trace.logInfo(_at.$3R.$D,"Uploading attachment via form submit.");$21R(n,"parentItemId",n.get_$BV().Id);$21R(n,"parentChangeKey",n.get_$BV().ChangeKey);$21R(n,"isInline",n.get_$CC().get_$8Y().toString());$21R(n,"X-OWA-CANARY",_a.$38.$15c());n.$rN.submit();n.$6r=2}function $21R(n,t,i){var r=$(n.$rN.ownerDocument.createElement("input"));r.attr("type","hidden");r.attr("name",t);r.val(i);n.$rN.appendChild(r[0])}_at.$3R.prototype={$rN:null,$Ki:null,$3ik:!1,$1b:null,$WF:0,$39W:null,$3Oy:!1,$3Bv:null,get_$CC:function(){return this.$W(_at.$3R.$3MC)},set_$CC:function(n){this.$N(_at.$3R.$3MC,n);return n},get_$BV:function(){return this.$W(_at.$3R.$40O)},set_$BV:function(n){this.$N(_at.$3R.$40O,n);return n},get_$2l:function(){return this.$W(_at.$3R.$16M)},set_$2l:function(n){n||(this.$6r=-1);this.$N(_at.$3R.$16M,n);return n},get_$3Xe:function(){return this.$W(_at.$3R.$3Xf)},set_$3Xe:function(n){this.$N(_at.$3R.$3Xf,n);return n},get_$3Bw:function(){return this.$W(_at.$3R.$3Bx)},set_$3Bw:function(n){this.$N(_at.$3R.$3Bx,n);return n},get_$69q:function(){return this.$3Bv},set_$69q:function(n){if(this.$3Bv===n)return n;this.$3Bv=n;$Q(this,"UploadAndShareAttachmentCommand");return n},get_$4FU:function(){return this.$W(_at.$3R.$4FV)},set_$4FU:function(n){this.$N(_at.$3R.$4FV,n);return n},get_$Qs:function(){return this.$1b},set_$Qs:function(n){this.$1b=n;$Q(this,"Error");return n},get_$2YY:function(){return this.$WF},set_$2YY:function(n){this.$WF=n;$Q(this,"AttachmentError");return n},get_$4BS:function(){return this.$39W},set_$4BS:function(n){this.$39W=n;$Q(this,"SuccessResponse");return n},$3xm:function(){_js.$F.prototype.$3xm.call(this);this.$N(_at.$3R.$3Bx,new _C(this.$$d_$9Fk,_at.$3R.$D));this.set_$69q(new _C(this.$$d_$9Fj,_at.$3R.$D))},$7Qv:function(n){if(this.$6r){if(this.$6r===2){_js.Trace.logInfo(_at.$3R.$D,"Response received.");var t="";try{t=this.get_$J()[0].contentWindow.document.body.innerText}catch(i){if(!(_a.UserAgent.getInstance().$8O&&i.number===-2146828218)){_js.Trace.logException(_at.$3R.$D,i,"Unhandled exception while executing HandleCreateAttachmentResponse");return}}if(this.$3ik)_js.$8.$c(t)&&$3DR(this,null,"Error sending the attachment upload form",1);else{var u=this,r=this;_at.$AU.$7QS(t,this.get_$CC(),this.get_$BV(),_g.$1Q.$g,function(n){_js.Trace.logInfo(_at.$3R.$D,"HandleCreateAttachmentResponse completed.");$3DR(u,n,null,0)},function(n){_js.Trace.logInfo(_at.$3R.$D,"HandleCreateAttachmentResponse failed: {0}",n.message);var t=1;if(n.ResponseCode){var i=n.ResponseCode.toString();r.get_$CC().get_$8Y()&&i==="ErrorInvalidOperation"?t=4:i==="ErrorMessageSizeExceeded"&&(t=3)}var u=n.message||"Exception message is null";$3DR(r,null,u,t)})}}}else{_js.Trace.logInfo(_at.$3R.$D,"Initializing.");this.$6r=1;$6EH(this);_js.$K.get_$L().$21(_at.$3R.$D,"ExecuteOpenFilePicker",this.$$d_$4va,0)}},$3bU:function(){if(!this.$3Oy){this.$3Oy=!0;var n=this.$Ki[0].value;if(!_js.$8.$c(n)){this.get_$CC().set_$1Q($6EI(this,n));this.get_$3Xe().$s()}}},$4va:function(){this.$Ki[0].click()},$9Fk:function(){this.$3ik=!1;this.$rN.action=_g.$5o.get_$4gp();$4IF(this)},$9Fj:function(){this.$3ik=!0;this.$rN.action=_g.$5o.get_$6ta();$21R(this,"subscriptionId",this.get_$b().get_$Qc());$4IF(this)}};_at.AttachmentPolicyLevel=function(){};_at.AttachmentPolicyLevel.prototype={undefined:0,block:1,forceSave:2,allow:3};_at.AttachmentPolicyLevel.registerEnum("_at.AttachmentPolicyLevel",!1);_at.$1Bw=function(){};_at.$1Bw.registerInterface("_at.$1Bw");_at.$5V=function(n,t){this.$JE=n||_at.$5V.$7Ok();this.$2Pl=t;this.$14o=this.$2Pl?this.$JE.DirectFileAccessOnPublicComputersEnabled:this.$JE.DirectFileAccessOnPrivateComputersEnabled;if(this.$14o){this.$4wQ=_at.$5V.$4pS(this.$JE.BlockedFileTypes,this.$JE.ForceSaveFileTypes,this.$JE.AllowedFileTypes);this.$5cm=_at.$5V.$4pS(this.$JE.BlockedMimeTypes,this.$JE.ForceSaveMimeTypes,this.$JE.AllowedMimeTypes)}this.$5p8=_at.$5V.$71r(this.$JE.ActionForUnknownFileAndMIMETypes)};_at.$5V.get_$L=function(){_at.$5V.$g||(_at.$5V.$g=new _at.$5V(_g.$S.get_$L().get_$4h0(),_g.$S.get_$L().get_$91x()));return _at.$5V.$g};_at.$5V.$71r=function(n){var t;try{t=_js.$2B.$Rq(_at.AttachmentPolicyLevel,n)}catch(i){t=1}return t};_at.$5V.$51W=function(n,t){return n[t]||0};_at.$5V.$4pS=function(n,t,i){var r={};_at.$5V.$3K8(r,i,3);_at.$5V.$3K8(r,t,2);_at.$5V.$3K8(r,n,1);return r};_at.$5V.$3K8=function(n,t,i){if(t)for(var u=t,f=u.length,r=0;r<f;++r){var e=u[r];n[e]=i}};_at.$5V.$7Ok=function(){var n=new _g.$Wn;return JsonParser.deserialize('{"AllowedFileTypes":[".rpmsg", ".xlsx", ".xlsm", ".xlsb", ".tiff", ".pptx", ".pptm", ".ppsx", ".ppsm", ".docx", ".docm", ".zip", ".xls", ".wmv", ".wma", ".wav", ".vsd", ".vss", ".vst",  ".vdx", ".vsx", ".vtx", ".vsdx", ".vssx", ".vstx", ".vsdm", ".vssm", ".vstm",".txt", ".tif", ".rtf", ".pub", ".ppt", ".png", ".pdf", ".one", ".mp3", ".jpg", ".gif", ".doc", ".bmp", ".avi"],"AllowedMimeTypes":["image/jpeg", "image/png", "image/gif", "image/bmp"],"ForceSaveFileTypes":[".swf", ".spl", ".dir", ".dcr"],"ForceSaveMimeTypes":["Application/x-shockwave-flash", "Application/octet-stream", "Application/futuresplash", "Application/x-director"],"BlockedFileTypes":[".vsmacros", ".msh2xml", ".msh1xml", ".ps2xml", ".ps1xml", ".mshxml", ".gadget", ".mhtml", ".psc2", ".psc1", ".msh2", ".msh1", ".aspx", ".xml", ".wsh", ".wsf", ".wsc", ".vsw", ".vbs", ".vbp", ".vbe", ".url", ".tmp", ".shs", ".shb", ".sct", ".scr", ".scf", ".reg", ".pst", ".ps2", ".ps1", ".prg", ".prf", ".plg", ".pif", ".pcd", ".osd", ".ops", ".mst", ".msp", ".msi", ".msh", ".msc", ".mht", ".mdz", ".mdw", ".mdt", ".mde", ".mdb", ".mda", ".maw", ".mav", ".mau", ".mat", ".mas", ".mar", ".maq", ".mam", ".mag", ".maf", ".mad", ".lnk", ".ksh", ".jse", ".its", ".isp", ".ins", ".inf", ".htc", ".hta", ".hpj", ".hlp", ".fxp", ".exe", ".der", ".csh", ".crt", ".cpl", ".com", ".cnt", ".cmd", ".chm", ".cer", ".bat", ".bas", ".asx", ".asp", ".app", ".adp", ".ade", ".ws", ".vb", ".js"],"BlockedMimeTypes":["application/x-javascript", "application/javascript", "application/msaccess", "x-internet-signup", "text/javascript", "application/xml", "application/prg", "application/hta", "text/scriplet", "text/xml"], "ActionForUnknownFileAndMIMETypes":"ForceSave","BlockWacViewingThroughUI":false,"WacViewableFileTypes":[".doc", ".docx", ".ppt", ".pptx", "xls", ".xlsx"],"WacViewingOnPublicComputersEnabled":true,"WacViewingOnPrivateComputersEnabled":true,"ForceWacViewingFirstOnPublicComputers":false,"ForceWacViewingFirstOnPrivateComputers":false,"ForceWebReadyDocumentViewingFirstOnPublicComputers":false,"ForceWebReadyDocumentViewingFirstOnPrivateComputers":false,"DirectFileAccessOnPrivateComputersEnabled":true,"DirectFileAccessOnPublicComputersEnabled":true,"WebReadyDocumentViewingOnPublicComputersEnabled":true,"WebReadyDocumentViewingOnPrivateComputersEnabled":true,"WebReadyDocumentViewingForAllSupportedTypes":false,"WebReadyFileTypes":[".xlsx", ".pptx", ".docx", ".xls", ".rtf", ".ppt", ".pps", ".pdf", ".dot", ".doc"],"WebReadyMimeTypes":["application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/vnd.openxmlformats-officedocument.wordprocessingml.document", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", "application/vnd.ms-powerpoint", "application/x-mspowerpoint", "application/vnd.ms-excel", "application/x-msexcel", "application/msword", "application/pdf"],"WebReadyDocumentViewingSupportedFileTypes":[".xlsx", ".pptx", ".docx", ".xls", ".rtf", ".ppt", ".pps", ".pdf", ".dot", ".doc"],"WebReadyDocumentViewingSupportedMimeTypes":["application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/vnd.openxmlformats-officedocument.wordprocessingml.document", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", "application/vnd.ms-powerpoint", "application/x-mspowerpoint", "application/vnd.ms-excel", "application/x-msexcel", "application/msword", "application/pdf"]}')};_at.$5V.$1k2=function(n,t){if(!n)return!1;for(var r=n,u=r.length,i=0;i<u;++i){var f=r[i];if(f===t)return!0}return!1};function $6E1(n,t,i){var r=_at.$5V.$51W(n.$4wQ,t);if(r===1)return 1;var u=_at.$5V.$51W(n.$5cm,i);return u===1?1:r===2||u===2?2:r===3||u===3?3:n.$5p8}function $6E4(n,t){var i=n.$2Pl?n.$JE.WacViewingOnPublicComputersEnabled:n.$JE.WacViewingOnPrivateComputersEnabled;return i&&$6E6(n,t)}function $6E3(n,t,i){var r=n.$2Pl?n.$JE.WebReadyDocumentViewingOnPublicComputersEnabled:n.$JE.WebReadyDocumentViewingOnPrivateComputersEnabled;return r&&$6E5(n,t,i)}function $6E2(n,t,i,r){return!i&&!r?!1:t?i?n.$JE.ForceWacViewingFirstOnPublicComputers:n.$JE.ForceWebReadyDocumentViewingFirstOnPublicComputers:i?n.$JE.ForceWacViewingFirstOnPrivateComputers:n.$JE.ForceWebReadyDocumentViewingFirstOnPrivateComputers}function $6E6(n,t){return _at.$5V.$1k2(n.$JE.WacViewableFileTypes,t)}function $6E5(n,t,i){if(_js.$8.$c(t)){if(!_js.$8.$c(i))return n.$JE.WebReadyDocumentViewingForAllSupportedTypes?_at.$5V.$1k2(n.$JE.WebReadyDocumentViewingSupportedMimeTypes,i):_at.$5V.$1k2(n.$JE.WebReadyMimeTypes,i)}else return n.$JE.WebReadyDocumentViewingForAllSupportedTypes?_at.$5V.$1k2(n.$JE.WebReadyDocumentViewingSupportedFileTypes,t):_at.$5V.$1k2(n.$JE.WebReadyFileTypes,t);return!1}_at.$5V.prototype={$2Pl:!1,$14o:!1,$5p8:0,$JE:null,$4wQ:null,$5cm:null,$2i9:function(n,t,i){$8(i)&&(i=!0);$8(n)||(n=n.toLowerCase());var f;f=this.$14o?$6E1(this,n,t):1;var u=!1;var r=!1;var e=!1;var o=!1;if(i){$6E4(this,n)&&(r=!0);$6E3(this,n,t)&&(u=!0);e=$6E2(this,this.$2Pl,r,u);r&&this.$JE.WacEditableFileTypes&&(o=_at.$5V.$1k2(this.$JE.WacEditableFileTypes,n))}return new _at.$wG(this.$14o,f,r,u,e,o)}};_at.$wG=function(n,t,i,r,u,f){!n;this.$14o=n;this.$hD=t;this.$1NK=i;this.$12g=r;this.$2gw=u;this.$4GK=f};_at.$wG.prototype={$hD:0,$14o:!1,$2gw:!1,$1NK:!1,$12g:!1,$4GK:!1,get_$3jU:function(){return this.$12g||this.$1NK},toString:function(){return String.format("Attachment PolicyLevel: {0}, DirectFileAccessEnabled: {1}, WAC: {2}, Stellent: {3}, ForceBrowserView: {4}, WacEdit: {5}",this.$hD,this.$14o,this.$1NK,this.$12g,this.$2gw,this.$4GK)}};_at.$r1=function(){this.$1gA=new FileReader};_at.$r1.prototype={$1gA:null,get_$Qs:function(){return this.$1gA.error},get_$cu:function(){return this.$1gA.result},get_$5j1:function(){return this.$1gA.onloadend},set_$5j1:function(n){this.$1gA.onloadend=n;return n},$5rl:function(n){var t=n;this.$1gA.readAsDataURL(t.$24F)},$438:function(n,t,i,r){var u=this;this.set_$5j1(function(){if(!u.get_$Qs()&&u.get_$cu()){var n=u.get_$cu().indexOf(",");var f=u.get_$cu().substring(n+1,u.get_$cu().length);_js.Trace.logInfo(r,"No error - Reading the file.");u.get_$cu().substring(0,n).indexOf("base64")!==-1?t(f):t(_a.$AO.$JK(f))}else{_js.Trace.logWarning(r,"File reader failed with error code {0}",u.get_$Qs());i()}});try{this.$5rl(n)}catch(f){_a.UserAgent.getInstance().$JT&&f.name==="NS_ERROR_FILE_ACCESS_DENIED"?_js.Trace.logInfo(r,"Firefox: failed to read an attachment. Exception: {0}",f.message):_js.Trace.logException(r,f,"Unexpected exception was thrown by FileReader.ReadAsDataURL.");i()}}};_at.$r2=function(){};_at.$r2.prototype={$3RO:function(){return new _at.$r1}};_at.$AU=function(n,t,i){_at.$AU.initializeBase(this);this.$hS=n;this.$1J=t;this.$QE=i};_at.$AU.$7QS=function(n,t,i,r,u,f){try{var e=JsonParser.deserialize(n);if(e&&e.Body)if(e.Body.ResponseMessages){var s=e.Body.ResponseMessages.Items[0];if(s.ResponseCode!=="NoError"){_js.Trace.logError(_at.$AU.$D,"Got a attachment error response with {0}",s.ResponseCode);var a=s.MessageText;var c={};c.ResponseCode=s.ResponseCode;f(Error.create(a,c))}else{var o=s.Attachments[0];t.set_$40(o.AttachmentId);i.Id=o.AttachmentId.RootItemId;i.ChangeKey=o.AttachmentId.RootItemChangeKey;t.set_$5y(o.Size||0);t.set_$BL(o.ContentType);t.get_$8Y()&&t.set_$Qj(o.ContentId);u(e)}}else{_js.Trace.logError(_at.$AU.$D,"Got no response message in the body; assuming it is a fault response");var l=e;f(Error.create(l.Body.FaultMessage))}else{_js.Trace.logError(_at.$AU.$D,"Got no response or response without body");f(Error.create(""))}}catch(h){_js.Trace.logError(_at.$AU.$D,"Got exception processing response: {0}, exception: {1}",n,h);n===""&&(h=Error.create(""));f(h)}};_at.$AU.$5qV=function(n,t,i){t.set_$40(n.Attachments[0].AttachmentId);t.get_$8Y()&&t.set_$Qj(n.Attachments[0].ContentId);n.Attachments[0].Size>0&&t.set_$5y(n.Attachments[0].Size);i.Id=n.Attachments[0].AttachmentId.RootItemId;i.ChangeKey=n.Attachments[0].AttachmentId.RootItemChangeKey};function $4ID(n,t){_at.$AU.$5qV(t,n.$1J,n.$QE)}function $4IC(n){var r=new _g.$1j(n.$QE.Id);r.ChangeKey=n.$QE.ChangeKey;var i=n.$1J.$29f();var t=new _g.$TK(r);t.Attachments=[i];t.RequireImageType=i.IsInline;t.IncludeContentIdInResponse=i.IsInline;t.ClientSupportsIrm=!0;return new _g.$TJ(n.get_$6o(),t)}_at.$AU.prototype={$hS:0,$1J:null,$QE:null,$MO:null,$7OT:function(){if(this.$1b||!this.get_$4dL()||!this.get_$4dL().response){_js.Trace.logInfo(_at.$AU.$D,"No success response because there's an error, or action is not complete.  Error: {0}",this.$1b);return null}return this.get_$4dL().response.result},$7XB:function(n){var t=new _g.$qP(this.$28);t.clientStoreItem=this.$hS;t.isQueued=!1;t.palContext=new _g.$n4(!1);this.$MO=$4IC(this);n.$1E1(this.$MO,t,this.$$d_$9K7,this.$$d_$9K8)},$42h:function(n){$4ID(this,n)}};_at.$xi=function(n,t,i){_at.$xi.initializeBase(this,[n,t,i]);var r=t.$Hc;this.$4qZ=r};_at.$xi.prototype={$4qZ:null,$7XB:function(n){var i=$4IC(this);var t=new _g.$qP(this.$28);t.clientStoreItem=this.$hS;t.isQueued=!0;t.palContext=new _g.$n4(!0);t.dataFile=this.$4qZ.$OR();n.$1E1(i,t,this.$$d_$9K7,this.$$d_$9K8)},$42h:function(n){$4ID(this,n)}};_at.$yC=function(n,t,i){_at.$yC.initializeBase(this);this.$hS=n;this.$1J=t;this.$QE=i;this.$7s=t.get_$40()||t.$E4};_at.$yC.prototype={$hS:0,$1J:null,$7s:null,$QE:null,$42h:function(n){this.$QE.Id=n.RootItemId.RootItemId;this.$QE.ChangeKey=n.RootItemId.RootItemChangeKey;this.$1J.$E4&&this.$1J.set_$40(this.$1J.$E4)},$7XB:function(n){var i=new _g.$TQ;i.ClientSupportsIrm=!0;var r=new _g.$yD(this.$28);r.itemContexts=new Array(1);var t=new _g.$yE;t.clientStoreItem=this.$hS;t.parentItemId=new _g.$1j(this.$QE.Id);t.parentItemId.ChangeKey=this.$QE.ChangeKey;i.AttachmentIds=[new _g.$DW(this.$7s.Id)];var u=new _g.$Xq(this.get_$6o());u.Body=i;r.itemContexts[0]=t;n.$1R1(u,r,this.$$d_$9K7,this.$$d_$9K8)}};_at.$Yu=function(n){_at.$Yu.initializeBase(this);_a.$5.$1V(_at.$Yu.$D,"DownloadAttachment");this.$7s=n};_at.$Yu.prototype={$7s:null,$2cU:null,$7XB:function(n){var i=new _g.$zY(this.$28);var t=new _g.$Yw(this.get_$6o());t.Body.AttachmentIds=[new _g.$DW(this.$7s)];t.Body.ShapeName="ItemAttachment";t.Body.AttachmentShape=_h.$11.get_$7dO();n.$3Z2(t,i,this.$$d_$9K7,this.$$d_$9K8)},$42h:function(n){var t=n.Attachments.length;if(t!==1){_js.Trace.logWarning(_a.$0.$1e,"GetAttachment response length = {0}",t);return}var i=n.Attachments[0];if(!i){_js.Trace.logWarning(_a.$0.$1e,"GetAttachment response contained null attachment");return}var r=_a.$1F.$9Ir(_g.$DA,i);this.$2cU=r.get_$48();if(!this.$2cU){_js.Trace.logWarning(_a.$0.$1e,"GetAttachment response contained null item");return}_js.Trace.logInfo(_a.$0.$1e,"GetAttachment succeeded for '{0}' on '{1}'",r.get_$1Q(),this.$2cU.get_$2h());_a.$5.$1G(null,"DownloadAttachment")}};_at.$Mo=function(n,t){_at.$Mo.initializeBase(this);this.$1n=n;this.$1J=t;this.$7s=t.get_$40()||t.$E4;if(!_g.$5q.isInstanceOfType(t)&&!_g.$97.isInstanceOfType(t))throw Error.notImplemented("Only FileAttachment and ItemIdAttachment are supported to get content.");};function $6EF(n){var t=new XMLHttpRequest;var i=String.format(_g.$5o.get_$6tY(),encodeURIComponent(n.$7s.Id));var r=this;t.onreadystatechange=function(){if(t.readyState===4)if(t.status===200){n.$1J.set_$Cc($3DQ(n,t.responseText));$F6(n,null)}else{var i=String.format("Unable to get file attachment content.\nAttachmentId = {0}\nResponseBody = {1}\nStatusText = {2}",n.$1J.get_$40().Id,t.responseText,t.statusText);_js.Trace.logError(n.$1n,i);$F6(n,Error.create(i))}};t.open("GET",i,!0);t.send(null);return 1}function $3DQ(n,t){if(t.startsWith("data:")){var i=";base64,";var r=t.indexOf(i);return t.substr(r+i.length)}else return t}_at.$Mo.prototype={$1n:null,$1J:null,$7s:null,$8W2:function(){if(_g.$5q.isInstanceOfType(this.$1J)){var n=this.$1J;if(_a.$11g.isInstanceOfType(n.$Hc)){var r=n.$Hc;var u=new _at.$r2;var f=u.$3RO();var t=this,i=this;f.$438(r,function(i){n.set_$Cc($3DQ(t,i));$F6(t,null)},function(){var t=String.format("Unable to read content of file {0}.",n.get_$1Q());_js.Trace.logWarning(i.$1n,t);$F6(i,Error.create(t))},this.$1n);return 1}else return $6EF(this)}else return _h.$19A.prototype.$8W2.call(this)},$8nZ:function(n,t,i){var r=this.$1J;if(_js.$8.$c(n))i(Error.create(String.format("The MIME content of item {0} cannot be retrieved.",r.get_$i().Id)));else{r.$zt=$3DQ(this,n);t()}},$7XB:function(n){n.$3aA(this.$1J.get_$i(),null,this.$$d_$9K7,this.$$d_$9K8)}};_at.$1By=function(){};_at.$1By.registerInterface("_at.$1By");var IAttachmentPreviewViewModelFactory=function(){};IAttachmentPreviewViewModelFactory.registerInterface("IAttachmentPreviewViewModelFactory");_at.$1Bx=function(){};_at.$1Bx.registerInterface("_at.$1Bx");_at.$sP=function(){};_at.$sP.registerInterface("_at.$sP");_at.$wE=function(n,t){_at.$wE.initializeBase(this,[1,"VM.Attachment.DeleteStarted"]);this.set_$5y(n);this.set_$7dE(t)};_at.$wE.prototype={get_$5y:function(){return this.$W("s")},set_$5y:function(n){$1O(this,"s",n);return n},get_$7dE:function(){return this.$W("w")},set_$7dE:function(n){$1O(this,"w",n);return n}};_at.$BU=function(n,t,i,r,u){this.$OL=_js.$8.$c(n)?"#":n;this.$VY=t;this.$Jv=i;this.$4Q=r;this.$2E=u?_u.Strings.l_OpenInBrowser_Text:_u.Strings.l_Download_Text;_js.Trace.logInfo(_a.$0.$1e,'AttachmentDownloadLinkViewModel isHidden={0}, preventNavigation={1}, text="{2}", URL={3}',this.$4Q,this.$VY,this.$2E,this.$OL)};_at.$BU.get_$557=function(){_at.$BU.$2jg||(_at.$BU.$2jg=new _at.$BU("#",!0,null,!0,!1));return _at.$BU.$2jg};_at.$BU.$I=function(n,t,i){_a.$3.$M(n,"viewModel");_a.$3.$M(i,"owaShell");var r;var u;var f;if(t){var e,o,s;_at.$BU.$6vh(n,e={val:u},o={val:r},s={val:f});u=e.val;r=o.val;f=s.val}else{var h,c,l;_at.$BU.$4ia(n,h={val:u},c={val:r},l={val:f});u=h.val;r=c.val;f=l.val}n.$Zu.get_$ky()&&(r=!0);return new _at.$BU(u,r,f,!1,t)};_at.$BU.$4ia=function(n,t,i,r){if(!n.$Fd.$14o||n.$Zu.get_$ky()||n.$Fd.$2gw||n.$1J.$GA){i.val=!0;t.val="#";r.val=n.$tn;return}switch(n.$Fd.$hD){case 3:i.val=!1;t.val=n.$OL;r.val=n.$5zm;break;case 2:i.val=!0;r.val=n.$tn;t.val=n.$OL;break;case 1:i.val=!0;t.val="#";r.val=n.$tn;break;case 0:default:i.val=!0;t.val="#";r.val=n.$tn;break}};_at.$BU.$6vh=function(n,t,i,r){if(n.$1J.$GA){i.val=!0;t.val="#";r.val=n.$tn;return}switch(n.get_$DZ()){case 5:i.val=!0;t.val="#";r.val=n.$5lj;break;case 3:i.val=!0;t.val="#";r.val=n.$1ur;break;case 1:case 2:i.val=!0;t.val="#";r.val=n.$Fd.$hD===3?new _C(function(){n.$71&&n.$71.$939(n)},_a.$0.$1e):n.$tn;break;default:_at.$BU.$4ia(n,t,i,r);break}};_at.$BU.prototype={$VY:!1,$OL:null,$Jv:null,$2E:null,$4Q:!1};_at.$wF=function(n,t,i,r,u){_at.$wF.initializeBase(this,[1,"VM.Attachment.Open"]);this.set_$5y(n);this.set_$5p7(t);this.set_$C4(i)};_at.$wF.prototype={get_$5y:function(){return this.$W("s")},set_$5y:function(n){$1O(this,"s",n);return n},get_$5p7:function(){return this.$W("pl")},set_$5p7:function(n){$1O(this,"pl",n);return n},get_$C4:function(){return this.$W("ro")},set_$C4:function(n){$1O(this,"ro",n);return n}};_at.$wI=function(n,t,i,r){_at.$wI.initializeBase(this,[1,"VM.Attachment.ServerDeleteCompleted"]);this.set_$4BQ(n);this.set_$5y(t);this.set_$5e2(i);this.set_$BL(r||"")};_at.$wI.prototype={get_$5y:function(){return this.$W("s")},set_$5y:function(n){$1O(this,"s",n);return n},get_$4BQ:function(){return this.$W("suc")},set_$4BQ:function(n){$1O(this,"suc",n);return n},get_$5e2:function(){return this.$W("nl")},set_$5e2:function(n){$1O(this,"nl",n);return n},get_$BL:function(){return this.$W("ct")},set_$BL:function(n){$1O(this,"ct",n);return n}};_at.$wK=function(n,t,i,r,u){_at.$wK.initializeBase(this,[1,"VM.Attachment.SingleUploadCompleted"]);this.set_$4BQ(n);this.set_$5y(t);this.set_$5p7(i);this.set_$5e2(r);this.set_$BL(u||"")};_at.$wK.prototype={get_$5y:function(){return this.$W("s")},set_$5y:function(n){$1O(this,"s",n);return n},get_$4BQ:function(){return this.$W("suc")},set_$4BQ:function(n){$1O(this,"suc",n);return n},get_$5p7:function(){return this.$W("pl")},set_$5p7:function(n){$1O(this,"pl",n);return n},get_$5e2:function(){return this.$W("nl")},set_$5e2:function(n){$1O(this,"nl",n);return n},get_$BL:function(){return this.$W("ct")},set_$BL:function(n){$1O(this,"ct",n);return n}};_at.$EU=function(){};_at.$EU.$67H=function(n,t,i,r,u){if(_a.$b.get_$Pa()){var f=new _at.$wF(n,t,i,r,u);_a.$b.$8E.$A7(f)}};_at.$EU.$9As=function(n,t){if(_a.$b.get_$Pa()){var i=new _at.$wE(n,t);_a.$b.$8E.$A7(i)}};_at.$EU.$9Aw=function(n,t,i,r){if(_a.$b.get_$Pa()){var u=new _at.$wI(n,t,i,r);_a.$b.$8E.$A7(u)}};_at.$EU.$3B2=function(n){if(_a.$b.get_$Pa()){var t=new _at.$wN(n);_a.$b.$8E.$A7(t)}};_at.$EU.$9Ax=function(n,t,i,r,u){if(_a.$b.get_$Pa()){var f=new _at.$wK(n,t,i,r,u);_a.$b.$8E.$A7(f)}};_at.$wN=function(n){_at.$wN.initializeBase(this,[1,"VM.Attachment.UploadStarted"]);$1O(this,"t",n)};_at.$18=function(n,t,i,r,u,f,e,o,s,h,c,l,a){this.$$d_$9Fn=Function.createDelegate(this,this.$9Fn);this.$$d_$4wO=Function.createDelegate(this,this.$4wO);this.$$d_$47Q=Function.createDelegate(this,this.$47Q);this.$$d_$3RA=Function.createDelegate(this,this.$3RA);this.$$d_$2bh=Function.createDelegate(this,this.$2bh);this.$$d_$4rl=Function.createDelegate(this,this.$4rl);this.$$d_$78e=Function.createDelegate(this,this.$78e);this.$$d_$4h1=Function.createDelegate(this,this.$4h1);this.$$d_$72g=Function.createDelegate(this,this.$72g);this.$$d_$8WN=Function.createDelegate(this,this.$8WN);this.$$d_$1R1=Function.createDelegate(this,this.$1R1);this.$$d_$8i0=Function.createDelegate(this,this.$8i0);this.$$d_$30m=Function.createDelegate(this,this.$30m);this.$$d_$8zT=Function.createDelegate(this,this.$8zT);this.$$d_$Q9=Function.createDelegate(this,this.$Q9);this.$3Xd=new _at.$r2;_at.$18.resolveInheritance();this.apcl=this.$a;this.rpcl=this.$w;_at.$18.initializeBase(this);this.$Zu=f||_at.$2K.get_$L();this.$27=o||_a.NativeBridge.get_$L();this.$30=e;this.$1K=c;this.$dj=l;this.$Un=a;this.set_$CC(n);this.$G=t;this.set_$8jL(u);this.$1D=h;n&&_g.$5q.isInstanceOfType(n)&&(this.$15G=n.get_$Cc());u&&(this.$5I=u.get_$hZ());this.$51=i;this.$93=r;this.set_$13t(!this.$51);this.set_$4wK(_a.$8h.$eZ(n.get_$1Q()));this.$Fd=_at.$5V.get_$L().$2i9(this.$rE,this.$1J.get_$BL(),_y.$8D.$3jV(this.$G,this.$1D));this.$1J&&this.$1J.get_$40()&&this.set_$1Yt(this.$Fd.get_$3jU()&&!this.$1J.$GA&&!this.$1J.get_$16f());this.$4FC();this.$2SK();this.$69L();$4I8(this);this.$tn=new _C(this.$$d_$Q9,_at.$18.$D);this.$5zm=new _C(this.$$d_$8zT,_at.$18.$D);this.$5lj=new _C(this.$$d_$30m,_at.$18.$D);this.$1ur=new _C(this.$$d_$8i0,_at.$18.$D);this.$1r=s||(u?u.get_$D2():new _y.$4p);if(!this.get_$7Xp()){this.$IX=new _C(this.$$d_$1R1,_at.$18.$D);this.$3y1=new _C(this.$$d_$8WN,_at.$18.$D);this.$3y9=new _C(this.$$d_$72g,_at.$18.$D)}this.$dO=new _y.$eK;this.$a7()};function $1Nd(n,t,i,r){_js.Trace.logWarning(_at.$18.$D,"create failed with error: {0}, {1}",t,i);n.$Iv=!0;n.$WF=t;n.$3M7=i;n.$71&&n.$71.$2oA(n.$5I)&&n.$71.$1aF(n,!1)}function $4I9(n,t){var i=n.$4q3=n.$3Xd.$3RO();i.$438(t,n.$$d_$47Q,n.$$d_$4wO,_at.$18.$D)}function $6ED(n){_js.Trace.logInfo(_at.$18.$D,"Submitting action for item attachment.");var i=n.$1J;var t=new _at.$AU(2,i,n.$71.get_$BV());t.add_$20(n.$$d_$2bh);t.add_$2m(n.$$d_$3RA);OwaApplication.$1T.$y(t)}function $4I7(n){_js.Trace.logInfo(_at.$18.$D,"Starting attachment upload.");var t=this,i=this;_g.$1Q.$g.$28a("CreateAttachment",n.$$d_$9Fn,$6E7(n),function(n){_js.Trace.logInfo(_at.$18.$D,"Upload attachment enqueued. UploadOnlineOnlyAttachment will be called when we have connection to the server.")},function(t){_js.Trace.logWarning(_at.$18.$D,"Enqueueing upload attachment failed: {0}",t.message);$1Nd(n,1,t.message,!0);$2T6(n,null)})}function $6E7(n){var t=n.$71.get_$BV();var i=new _g.$1j(t.Id);i.ChangeKey=t.ChangeKey;var r=new _g.$TK(i);return new _g.$TJ(null,r)}function $6EE(n){_js.Trace.logInfo(_at.$18.$D,"Submitting action for PAL attachment upload.");var t=new _at.$xi(2,n.$1J,n.$71.get_$BV());t.add_$20(n.$$d_$2bh);t.add_$2m(n.$$d_$3RA);OwaApplication.$1T.$y(t)}function $2T6(n,t){var i=n.$Iv?_y.$pM.toString(n.$WF):"";_js.Trace.logInfo(_at.$18.$D,"Attachment create completed. Status: {0}",i);if(n.$42x){t&&n.set_$4FX(t.$7OT());n.$42x(n.$2SN)}n.set_$69r(!1);n.set_$1Yt(!n.$Iv&&n.$Fd.get_$3jU()&&!n.$1J.$GA&&!n.$1J.get_$16f());_at.$EU.$9Ax(!n.$Iv,n.$1J.get_$5y(),n.$Fd.$hD,n.$1J.get_$1Q().length,n.$1J.get_$BL());if(!n.$Iv&&(n.$1D.get_$4gy()||_g.$97.isInstanceOfType(n.$1J)||_g.$Dr.isInstanceOfType(n.$1J)||_g.$5q.isInstanceOfType(n.$1J)&&_y.$gW.isInstanceOfType(n.$1J.$Hc))){_js.Trace.logInfo(_at.$18.$D,"Incrementing parent well size.");(!t||n.$71.$2oA(n.$5I))&&n.$71.$em(n.$1J.get_$5y());$4I8(n)}var r=null;t&&t.get_$4dL()&&(r=t.get_$4dL().correlationId);_a.$5.$1G(n.$4h6,null,i,r);_a.$5.endPT("MailComposeUpload");$EQ(n,"OnUploadCompleteEvent",n)}function $3DO(n){$6EC(n);n.$1J?n.$1J.get_$40()?_js.Trace.logInfo(_at.$18.$D,"SafeOpenAttachment: Name={0}, ID={1}",n.$1J.get_$1Q(),n.$1J.get_$40().Id):_js.Trace.logWarning(_at.$18.$D,"SafeOpenAttachment: AttachmentId is null"):_js.Trace.logWarning(_at.$18.$D,"SafeOpenAttachment: Attachment is null");_js.Trace.logInfo(_at.$18.$D,"SafeOpenAttachment: Policy={0}",n.$Fd.toString());if(n.$Fd.$2gw){_js.Trace.logInfo(_at.$18.$D,"Attachment policy forces browser viewing.");n.$G.get_$O()==="Mouse"?n.$1r.$3A(0,_u.Strings.l_ForceBrowserViewingFirstAlert_Text,null):n.$1r.$3A(0,_u.Strings.l_ForceBrowserViewingFirstAlertNonMouse_Text,null);return}if(!n.$Fd.$14o){n.$1r.$3A(0,_u.Strings.l_DirectFileAccessDisabled_Text,null);return}if(n.$Fd.$hD===1){n.$1r.$3A(0,_u.Strings.l_BlockedAlert_Text,null);return}if(n.$1J.$GA){var t=_a.$1A.$lv();_js.Trace.logInfo(_a.$0.$p9,"Saving S/MIME attachment {0}.",n.$1J.get_$1Q());var i=t.save(n.$1J.get_$1Q(),_a.$1A.$2hV(n.$1J.get_$40().Id),_u.Strings.l_Smime_SaveAttachmentDialogTitle_Text);i?_js.Trace.logInfo(_a.$0.$p9,"S/MIME attachment {0} is saved successfully.",n.$1J.get_$1Q()):_js.Trace.logWarning(_a.$0.$p9,"S/MIME attachment {0} is not saved. Check the log of S/MIME plugin instead.",n.$1J.get_$1Q());return}else if(n.$1J.get_$16f()){var r=_a.$1A.$lv();r.open(n.$1J.$1FA,null,!1);return}if(n.$Fd.$hD===2){$6E9(n);return}if(n.$Zu.get_$ky()){_js.Trace.logInfo(_at.$18.$D,"Will use PAL to open attachment.");$6E8(n)}else{_js.Trace.logInfo(_at.$18.$D,"Opening attachment with download URL {0}",n.$OL);n.$dO.$Q9(n.$OL)}}function $6E9(n){if(n.$G.get_$O()==="Mouse"){_js.Trace.logInfo(_at.$18.$D,"Attachment policy forces save.");n.$1D.get_$7i()?n.$1r.$3A(0,_u.Strings.l_IE_ForceSaveAlert_Text,null):n.$1r.$3A(0,_u.Strings.l_Default_ForceSaveAlert_Text,null)}else{_js.Trace.logInfo(_at.$18.$D,"Attachment policy forces save, but device doesn't support download.");n.$1r.$3A(0,_u.Strings.l_UnsupportedAttachment_Text,null)}}function $4I6(n,t){var i=n.$7s;if(i!==t){$6EA(n,i,t);n.$7s=t;_js.Trace.logInfo(_at.$18.$D,"Attachment ID: {0}",n.$7s?n.$7s.Id:"null")}}function $4I8(n){n.set_$37K(n.$1vU||_g.$97.isInstanceOfType(n.$1J)&&!n.$1J.get_$5y()||_g.$5q.isInstanceOfType(n.$1J)&&_y.$gW.isInstanceOfType(n.$1J.$Hc)&&!n.$1J.get_$5y())}function $6EC(n){if(!n.$1J.$GA&&!n.$1J.get_$16f()&&n.get_$8Qt()){var t=_g.$1Q.$g.$lw(n.$1J.get_$40());n.$1J.get_$40().Id!==t.Id&&n.$1J.set_$40(t)}}function $6E8(n){_js.Trace.logInfo(_at.$18.$D,"OpenAttachmentUsingPAL, download status={0}",n.$1vE);if(!n.$71.$2oA(n.$5I)){_js.Trace.logWarning(_at.$18.$D,"The context has changed from "+n.$5I+" to "+n.$71.get_$hZ()+", opening attachment using PAL has been skipped.");return}if(n.$71.get_$3fm()||!n.$51){_js.Trace.logInfo(_at.$18.$D,"Returning because the attachment is a fake message. IsComposeReadOnlyWell = {0} and IsReadOnly {1}",n.$71.get_$3fm(),n.$51);return}var t=_at.$P0.$75M(n);_js.Trace.logInfo(_at.$18.$D,"PAL attachment download parameters: {0}",t.toString());switch(n.$1vE){case 0:case 1:n.$5h3(0);_js.Trace.logInfo(_at.$18.$D,"Starting PAL attachment download.");n.$Zu.$4tk(t);break;case 3:case 2:_js.Trace.logInfo(_at.$18.$D,"Canceling PAL attachment download.");n.$Zu.$AQ(t);break;case 4:_js.Trace.logInfo(_at.$18.$D,"PAL attachment download complete.");var i=this;n.$Un.$I(function(){var i=n.$Un.get_$1d().$I(_g.$S.get_$L().get_$1t().get_$IJ());_at.$Ac.$8hv(n.$27,i.get_$1Cz(),n.$4gx,t.$1Xa,t.$1F9,function(){_js.Trace.logInfo(_at.$18.$D,"Attachment opened successfully.")},function(t){_js.Trace.logWarning(_at.$18.$D,"Attachment open failed with errorCode {0}",t);t===2&&n.set_$40E(1);var i=_at.$Ac.$7K0(t);n.$1r.$3A(0,i,null)})});break;default:break}}function $6EA(n,t,i){if(_g.$DA.isInstanceOfType(n.$1J)){_js.Trace.logInfo(_at.$18.$D,"ItemAttachment for PAL status:Downloaded");n.set_$40E(4)}else{!$8(t)&&t.Id&&n.$Zu.$20X(t.Id);!$8(i)&&i.Id&&n.$Zu.$HX(i.Id,n)}}function $6EB(n){if(n.$1J&&n.$1J.get_$40()&&!_g.$DA.isInstanceOfType(n.$1J)){_js.Trace.logInfo(_at.$18.$D,"Unsubscribing for attachment with name {0} and id {1}",n.$1J.get_$1Q(),n.$1J.get_$40());n.$Zu.$20X(n.$1J.get_$40().Id)}}function $4I5(n,t,i){var r;var u=t;if(t>=1073741824){u/=1073741824;r=_u.Strings.l_SizeWithGigabyteAbbreviation_Text}else if(t>=1048576){u/=1048576;r=_u.Strings.l_SizeWithMegabyteAbbreviation_Text}else if(t>=1024){u/=1024;r=_u.Strings.l_SizeWithKilobyteAbbreviation_Text}else r=_u.Strings.l_SizeWithByteAbbreviation_Text;var f=String.format(r,Math.round(u*Math.pow(10,i))/Math.pow(10,i));return String.format('<span class="progressValueNoWrap">{0}</span>',f)}_at.$18.prototype={$tn:null,$5zm:null,$5lj:null,$1ur:null,$IX:null,$3y1:null,$3y9:null,$dO:null,$51:!1,$93:!1,$G:null,$1D:null,$5I:null,$1K:null,$dj:null,$Un:null,$1J:null,$OL:null,$2EQ:!1,$2Zx:!1,$4FW:!1,$5ld:!1,$Fd:null,$71:null,$3G:!1,$ui:!1,$1vE:0,$31O:null,$2Qw:null,$39P:null,$13W:0,$15Q:null,$1SJ:0,$2SN:null,$7s:null,$1vU:!1,$Iv:!1,$WF:0,$3M7:null,$Lv:!1,$rE:null,$27:null,$1r:null,$42x:null,$mH:null,$Zu:null,$4gx:null,$48v:!1,$2kS:null,$1cU:null,$CG:null,$2D4:!1,$4h6:null,$15G:null,$30:null,$1fu:null,$1fm:null,$1fy:null,$s8:!1,$4q3:null,add_$1up:function(n){this.$2Z("OnUploadCompleteEvent",n)},remove_$1up:function(n){this.$2b("OnUploadCompleteEvent",n)},add_$1uT:function(n){this.$2Z("OnDeleteCompleteEvent",n)},remove_$1uT:function(n){this.$2b("OnDeleteCompleteEvent",n)},add_$2zY:function(n){this.$2Z("OnDownloadCompleteEvent",n)},remove_$2zY:function(n){this.$2b("OnDownloadCompleteEvent",n)},get_$4gh:function(){return this.$1fm},set_$4gh:function(n){this.$1fm=n;return n},get_$DZ:function(){this.$13W||(this.$13W=this.$4z8());return this.$13W},set_$DZ:function(n){n!==this.$13W&&(this.$13W=n);return n},get_$CC:function(){return this.$1J},set_$CC:function(n){var t=this.$1J;if(t!==n){$8(t)||t.remove_$8C(this.$$d_$4h1);this.$1J=n;var i=$8(n);if(!i){n.add_$8C(this.$$d_$4h1);_js.Trace.logInfo(_a.$0.$1e,"Attachment: {0}",n.get_$1Q())}$4I6(this,i?null:n.get_$40());$6(this,"Attachment");$6(this,"ReferenceAttachment")}return n},get_$8pJ:function(){return _g.$Dr.isInstanceOfType(this.$1J)?this.$1J:null},get_$2X:function(){return this.$3G},set_$2X:function(n){this.$3G=n;$6(this,"IsSelected");return n},get_$3VT:function(){return this.$OL},set_$3VT:function(n){if(this.$OL!==n){this.$OL=n;_js.Trace.logInfo(_at.$18.$D,"Attachment download URL: {0}",this.$OL);$6(this,"DownloadUrl")}return n},get_$7ct:function(){return this.$2EQ},set_$7ct:function(n){if(this.$2EQ!==n){this.$2EQ=n;$6(this,"IsTriggeredPolicyTip")}return n},get_$13t:function(){return this.$2Zx},set_$13t:function(n){this.$2Zx=n;$6(this,"CanDelete");return n},get_$69r:function(){return this.$4FW},set_$69r:function(n){this.$51||this.set_$13t(!n);this.$4FW=n;$6(this,"UploadInProgress");return n},get_$1Yt:function(){return this.$5ld},set_$1Yt:function(n){this.$5ld=n;$6(this,"OpenDocumentInBrowserLinkVisible");return n},get_$7XC:function(){return this.$71},get_$8jL:function(){return this.$71},set_$8jL:function(n){this.$71=n;$6(this,"ParentWell");return n},get_$Xr:function(){return this.$ui},set_$Xr:function(n){if(this.$ui!==n){this.$ui=n;this.$71&&this.$71.$7Rs(this);$6(this,"ShouldBeHidden")}return n},get_$5nk:function(){return this.$1vU},set_$5nk:function(n){if(this.$1vU!==n){this.$1vU=n;$6(this,"PendingNonHtml5Upload")}return n},get_$37K:function(){return this.$48v},set_$37K:function(n){if(this.$48v!==n){this.$48v=n;$6(this,"ShouldSizeBeHidden")}return n},get_$5DC:function(){return!1},get_$4wK:function(){return this.$rE},set_$4wK:function(n){if(this.$rE!==n){this.$rE=n;$6(this,"FileExtension")}return n},get_$64d:function(){return this.$2Qw},set_$64d:function(n){this.$2Qw=n;$6(this,"SubmitUploadFormCommand");return n},get_$97B:function(){return this.$39P},set_$97B:function(n){this.$39P=n;$6(this,"SubmitUploadAndShareFormCommand");return n},get_$Qc:function(){throw Error.notImplemented("This getter must be overridden");},set_$Qc:function(n){throw Error.notImplemented("This setter must be overriden");return n},get_$1R2:function(){return this.$IX},get_$4y7:function(){return this.$15Q},set_$4y7:function(n){this.$15Q=n;_js.Trace.logWarning(_at.$18.$D,"Attachment form upload error: {0}",this.$15Q);$6(this,"FormUploadError");return n},get_$4y6:function(){return this.$1SJ},set_$4y6:function(n){this.$1SJ=n;_js.Trace.logWarning(_at.$18.$D,"Attachment form upload error code: {0}",this.$1SJ);$6(this,"FormUploadAttachmentError");return n},get_$4FX:function(){return this.$2SN},set_$4FX:function(n){this.$2SN=n;$6(this,"UploadSuccessResponse");return n},get_$8Qt:function(){return _g.$5q.isInstanceOfType(this.$1J)&&_a.$7s.isInstanceOfType(this.$1J.$Hc)},get_$5lu:function(){return this.$Iv},get_$2YY:function(){return this.$WF},get_$mI:function(){return this.$mH},set_$mI:function(n){this.$mH=n;return n},get_$mD:function(){var n=_y.$8D.$2hS(this.$1J.get_$40(),this.$93,_g.$5o.get_$56S());_js.Trace.logInfo(_at.$18.$D,"Image preview URL: {0}",n);return n},get_$Ug:function(){return this.$1D.get_$ry()},get_$2lj:function(){return this.$1D.get_$1GU()},get_$2lz:function(){return this.get_$DZ()!==2&&this.get_$DZ()!==1||this.$1J.get_$8Y()?!1:this.$Fd.$hD===3},get_$59q:function(){return this.get_$DZ()!==2?!1:this.$Fd.$hD===3},get_$54P:function(){return this.get_$DZ()!==2&&this.get_$DZ()!==4},get_$54R:function(){return!this.$1J.$GA&&(this.get_$DZ()===2||this.get_$DZ()===1)},get_$55y:function(){if(this.$2kS)return this.$2kS;var n;n=this.get_$3g6()?this.get_$DZ()===5||this.$G.get_$O()!=="TouchNarrow"&&!this.$1D.get_$5h()&&(!this.$93||this.$93&&this.get_$DZ()!==3):this.get_$DZ()===5||this.$G.get_$O()==="Mouse"&&this.get_$DZ()!==3;_js.Trace.logInfo(_at.$18.$D,"IconLinkViewModel preview = {0}",n);this.$2kS=_at.$BU.$I(this,n,this.$G);return this.$2kS},get_$663:function(){if(this.$1cU)return this.$1cU;if(this.$G.get_$O()!=="Mouse"){this.$1cU=_at.$BU.get_$557();return this.$1cU}var t=!1;var n=!1;if(this.$1J.$GA){n=_g.$DA.isInstanceOfType(this.$1J);t=_g.$DA.isInstanceOfType(this.$1J)}else switch(this.get_$DZ()){case 3:n=!1;t=this.get_$3g6()?!1:!this.$93;break;case 6:n=!1;t=!1;break;case 1:case 2:t=!1;n=!1;break;case 5:case 4:n=!0;break;case 0:default:n=!0;break}if(n){_js.Trace.logInfo(_at.$18.$D,"TextLinkViewModel is hidden");this.$1cU=_at.$BU.get_$557()}else{_js.Trace.logInfo(_at.$18.$D,"TextLinkViewModel preview = {0}",t);this.$1cU=_at.$BU.$I(this,t,this.$G)}return this.$1cU},get_$40E:function(){return this.$1vE},set_$40E:function(n){this.$1vE=n;$6(this,"PALAttachmentDownloadStatus");return n},get_$8j9:function(){return this.$31O},set_$8j9:function(n){this.$31O=n;$6(this,"PALAttachmentCurrentDowloadedBytes");return n},get_$3QS:function(){if(!this.$CG){var n=new Array(0);this.$CG=new _0365m.$2c(n)}return this.$CG},get_$l9:function(){return this.$G.get_$O()!=="Mouse"},get_$5N:function(){var n=this.get_$DZ();switch(n){case 4:return _u.Strings.l_BlockedContent_Text;case 1:case 2:return _u.Strings.l_ClickForPreview_Text;case 6:case 3:return this.$1J.get_$1Q();case 5:return _u.Strings.l_ClickForPreview_Text;default:break}return""},get_$3g9:function(){return this.$2D4},set_$3g9:function(n){if(this.$2D4!==n){this.$2D4=n;this.$2SK()}return n},get_$y5:function(){return this.$Lv},set_$y5:function(n){if(this.$Lv!==n){this.$Lv=n;$6(this,"IsDeleted")}return n},get_$157:function(){_a.$3.$8z(this.get_$DZ()===5,"Invalid Operation: EmbeddedItemClass should only be invoked when the Attachment is an ItemAttachment");return this.$1J.get_$DZ()},get_$3g6:function(){return!!this.$1K&&this.$1K.$7x("DocCollab")},get_$3hq:function(){return this.get_$3g6()&&this.$G.get_$O()==="TouchWide"&&this.$Fd.$1NK&&!this.$Zu.get_$ky()},get_$60n:function(){return this.get_$3hq()?!1:this.$Zu.get_$ky()},get_$6th:function(){return this.$1fu},set_$6th:function(n){if(this.$1fu!==n){this.$1fu=n;$6(this,"AttachmentPreviewViewModel")}return n},get_$mV:function(){return this.$s8},set_$mV:function(n){this.$s8=n;n&&this.set_$1Yt(!1);return n},get_$7Xp:function(){return!this.$71},get_$6wc:function(){_js.Trace.logInfo(_at.$18.$D,"Attachment class: {0}",this.$13W);var n;switch(this.get_$DZ()){case 0:n=!0;break;case 5:_js.Trace.logInfo(_at.$18.$D,"Embedded item class: {0}",this.get_$157());switch(this.get_$157()){case 6:case 3:case 1:case 2:case 5:n=!0;break;default:n=!1;break}break;default:n=!1;break}_js.Trace.logInfo(_at.$18.$D,"Can open: {0}",n);return n},$2SK:function(){this.$71?this.set_$Xr(this.$2D4||this.$1J.get_$8Y()&&this.$71.get_$7TT()):this.set_$Xr(this.$2D4||this.$1J.get_$8Y());this.set_$Xr(this.$ui||this.$1J.get_$16d())},$8WN:function(){_js.Trace.logInfo(_at.$18.$D,"File selected.");this.set_$3g9(!1);this.$71&&this.$71.$8WM(this)},$3Bu:function(){_js.Trace.logInfo(_at.$18.$D,"submitting upload to server");this.$Iv=!1;if(_g.$5q.isInstanceOfType(this.$1J)){var n=this.$1J;_a.$7s.isInstanceOfType(n.$Hc)?$6EE(this):$4I7(this)}else(_g.$97.isInstanceOfType(this.$1J)||_g.$Dr.isInstanceOfType(this.$1J))&&$4I7(this)},$64b:function(){_js.Trace.logInfo(_at.$18.$D,"submitting delete to server");this.$Iv=!1;var n=new _at.$yC(2,this.$1J,this.$71.get_$BV());n.add_$20(this.$$d_$78e);n.add_$2m(this.$$d_$4rl);OwaApplication.$1T.$y(n)},$68b:function(){$6EB(this)},$50K:function(){var r=this.$1J;var u=r.$Hc;var n=this.$3Xd.$3RO();var t=this;n.set_$5j1(function(){if(n.get_$Qs())_js.Trace.logWarning(_at.$18.$D,"HTML5 file reader attach failed with error code {0}",n.get_$Qs());else{var i=n.get_$cu().indexOf(",");var r=n.get_$cu().substring(i+1,n.get_$cu().length);t.$15G=n.get_$cu().substring(0,i).indexOf("base64")!==-1?r:_a.$AO.$JK(r);$EQ(t,"OnUploadCompleteEvent",t)}});try{n.$5rl(u)}catch(i){this.$1D.get_$ry()&&i.name==="NS_ERROR_FILE_ACCESS_DENIED"?_js.Trace.logInfo(_at.$18.$D,"Firefox: failed to read an attachment. Exception: {0}",i.message):_js.Trace.logException(_at.$18.$D,i,"Unexpected exception was thrown by FileReader.ReadAsDataURL.")}},$5rY:function(){this.$15G=null;$EQ(this,"OnDeleteCompleteEvent",this)},$2cf:function(){var n=new _a.$7t;n.$IN("E",this.$rE);n.$7c("S",this.$1J.get_$5y());return n.toString()},$1RM:function(){_js.Trace.logInfo(_at.$18.$D,"Getting attachment content from server");this.$Iv=!1;var t=new _at.$Mo(_at.$18.$D,this.$1J);var n=this;t.add_$2m(function(){$EQ(n,"OnDownloadCompleteEvent",n);n.$s8||n.$3RA(null);n.set_$1Yt(!1)});var i=this;t.add_$20(function(){_js.Trace.logWarning(_at.$18.$D,"Download failed with error: {0}",t.$1b.message);i.$Iv=!0;i.$s8||i.$2bh(null)});OwaApplication.$1T.$y(t)},$1Yp:function(n){_js.Trace.logInfo(_at.$18.$D,"Got attachment status {0}",n);this.set_$40E(n)},$5h3:function(n){this.set_$8j9(String.format(_u.Strings.l_DownloadAttachmentProgress_Text,$4I5(this,n,1),$4I5(this,this.$1J.get_$5y(),0)))},$TR:function(n){_js.Trace.logWarning(_at.$18.$D,"Unable to download attachment with name {0} and error is {1}",this.$1J.get_$1Q(),n);this.$1r.$3A(0,n,null)},$5fv:function(n){_js.Trace.logInfo(_at.$18.$D,"Found/Saved the record in offline db {0} {1}",n.DataID,n.AttachmentId);this.$4gx=n},$58C:function(n){if(_g.$97.isInstanceOfType(this.$1J)){_js.Trace.logInfo(_at.$18.$D,"Uploading item attachment.");$6ED(this)}else if(_g.$5q.isInstanceOfType(this.$1J)){var t=this.$1J;if(this.$15G){_js.Trace.logInfo(_at.$18.$D,"Uploading file attachment with pasted image from clipboard.");this.$47Q(this.$15G)}else if(t.get_$Cc()){_js.Trace.logInfo(_at.$18.$D,"Uploading file attachment with content.");this.$47Q(null)}else if(this.$1D.get_$4gt()){_js.Trace.logInfo(_at.$18.$D,"Uploading HTML5 file attachment.");$4I9(this,t.$Hc)}else{_js.Trace.logInfo(_at.$18.$D,"Uploading Non-HTML5 file attachment.");this.$9Fm()}}else if(this.$1D.get_$4gt()&&_g.$Dr.isInstanceOfType(this.$1J)){var i=this.$1J;_js.Trace.logInfo(_at.$18.$D,"Uploading HTML5 reference attachment.");$4I9(this,i.$Hc)}else{_js.Trace.logError(_at.$18.$D,"Unsupported upload type.");n(null)}},$4z8:function(){var n=0;if(_g.$5q.isInstanceOfType(this.$1J))if(this.$Fd.get_$3jU())n=3;else if(this.$Fd.$hD===1)n=4;else{var t,i;(i=_y.$8D.$48n(this.$1J,t={val:n}),n=t.val,i)||(n=6)}else n=_g.$DA.isInstanceOfType(this.$1J)?5:_g.$97.isInstanceOfType(this.$1J)?0:4;return n},$4FC:function(){var n=!!this.$1J.get_$40();var t=n?this.$1J.get_$40().Id:null;var i=t?_bc.$BG.$59N(t):!1;var r=this.$Fd.$hD===1;_js.Trace.logInfo(_at.$18.$D,"UpdateDownloadUrl: idExists={0}, isClientId={1}, isDiscovery={2}, policyInfo: {3}",n,i,this.$93,this.$Fd.toString());!n||r||i||this.$1J.get_$16f()?this.set_$3VT(null):this.set_$3VT(_y.$8D.$2hS(this.$1J.get_$40(),this.$93))},$2bh:function(n){var t=n.$1b?n.$1b.message:"";$1Nd(this,1,t,!0)},$3RA:function(n){$2T6(this,n)},$69L:function(){this.set_$5nk(!this.$51&&this.$1D.get_$4gy()&&$8(this.$1J.get_$40())&&!_g.$97.isInstanceOfType(this.$1J))},$4h1:function(n,t){if(t==="ContentType"||t==="Name"||t==="AttachmentId"){t==="Name"&&this.set_$4wK(_a.$8h.$eZ(this.$1J.get_$1Q()));if(t==="ContentType"||t==="Name"){this.$Fd=_at.$5V.get_$L().$2i9(this.$rE,this.$1J.get_$BL(),this.$G.get_$O()==="Mouse"||this.$1D.get_$1HR());this.$2SK()}if(t==="AttachmentId"){$4I6(this,this.$1J.get_$40());this.$69L()}this.$4FC()}},$47Q:function(n){_js.Trace.logInfo(_at.$18.$D,"Submitting server action for file attachment with content.");var i=this.$1J;n&&i.set_$Cc(n);var t=new _at.$AU(2,i,this.$71.get_$BV());t.add_$20(this.$$d_$2bh);t.add_$2m(this.$$d_$3RA);OwaApplication.$1T.$y(t)},$9Fm:function(){this.$2Qw.$s()},$72g:function(){_js.$8.$c(this.$15Q)||$1Nd(this,this.$1SJ,this.$15Q,!1);$2T6(this,null)},$1R1:function(){_js.Trace.logInfo(_at.$18.$D,"Deleting attachment.");this.set_$y5(!0);var n=!!this.$1J.get_$40()&&!!this.$1J.get_$40().Id&&!this.$1J.get_$40().Id.startsWith("smime-");if(n){_js.Trace.logInfo(_at.$18.$D,"Deleting attachment from server.");this.$71.$1aF(this,!1);this.$71.$1a0(this)}else if(this.$4FW)_js.Trace.logError(_at.$18.$D,"Somehow a user was able to try to delete an attachment in the process of being uploaded.");else{if(_g.$5q.isInstanceOfType(this.$1J)){var t=this.$1J;if(_a.$7s.isInstanceOfType(t.$Hc)){_js.Trace.logInfo(_at.$18.$D,"Deleting file attachment via PAL.");var i=t.$Hc;this.$27.$Wb.$1EY(i.get_$1Qn())}else _js.Trace.logInfo(_at.$18.$D,"Not a PAL file attachment.")}else _js.Trace.logInfo(_at.$18.$D,"Not a file attachment.");this.$71.$1aF(this,!0)}_at.$EU.$9As(this.$1J.get_$5y(),!n)},$9Fn:function(n,t,i){this.set_$69r(!0);if(this.$Lv){_js.Trace.logInfo(_at.$18.$D,"Attachment skipped because it's been deleted while it was pending.",this.$1J.get_$1Q());t(null);return}_a.$5.stPT(_a.$0.$1e,"MailComposeUpload",3);this.$4h6=_a.$5.$1V(_a.$0.$1e,"MailComposeUpload",!0);var u=n;var r=u.Body.ParentItemId;this.$71.get_$BV().Id=r.Id;this.$71.get_$BV().ChangeKey=r.ChangeKey;this.$42x=t;this.$58C(t)},$4wO:function(){$1Nd(this,2,String.format("FileReader.Error: {0}",this.$4q3.get_$Qs()),!1);$2T6(this,null)},$78e:function(n){_js.Trace.logWarning(_at.$18.$D,"delete failed with error: {0}",n.$1b.message);this.$Iv=!0;this.set_$y5(!1);this.$71.$2oA(this.$5I)&&!this.$s8&&this.$71.$1OB(this)},$4rl:function(n){$EQ(this,"OnDeleteCompleteEvent",this);_at.$EU.$9Aw(this.$Iv,this.$1J.get_$5y(),this.$1J.get_$1Q().length,this.$1J.get_$BL())},$8zT:function(){_y.$9M.$37M=this.$G.get_$O()==="Mouse"&&!this.get_$5DC();if(this.$30&&this.$71&&this.$71.get_$BV()){var n=this.$71.get_$BV();if(n){var t=this;this.$30.$I(function(t){t.$3zF(n)})}}},$Q9:function(){if(this.$1J.get_$40())if(_g.$DA.isInstanceOfType(this.$1J))this.$30m();else if(_g.$5q.isInstanceOfType(this.$1J))$3DO(this);else if(_g.$97.isInstanceOfType(this.$1J)){var n=this.$1J;n.get_$i()?this.$30m():n.get_$Sp()?this.$30m():$3DO(this)}else $3DO(this);_at.$EU.$67H(this.$1J.get_$5y(),this.$Fd.$hD,this.$51,!1,!1)},$30m:function(){if(!this.get_$6wc()){_js.Trace.logInfo(_at.$18.$D,"Unsupported item.");this.$1r.$3A(0,_u.Strings.l_ItemAttachmentNotSupported_Text,null);return}var n=null;_g.$DA.isInstanceOfType(this.$1J)?n=this.$1J.get_$40().Id:_g.$97.isInstanceOfType(this.$1J)&&(n=this.$1J.get_$40().Id);var t={};t.AttachmentItemID=n;_js.Trace.logInfo(_at.$18.$D,"Opening item attachment in pop-out window.");this.$G.$5i(_y.$lf,null,t,_y.$3p.get_$RN())},$8i0:function(){if(this.$1fu){this.$1fu.$LB();return}if(this.$dj){var n=this;this.$dj.$I(function(t){n.set_$6th(t.$I(n));n.$1fu.$LB()})}_at.$EU.$67H(this.$1J.get_$5y(),this.$Fd.$hD,this.$51,!0,this.$Fd.$1NK)}};_at.$Jl=function(n,t,i,r,u,f,e,o,s,h,c){this.$9Gd=_at.$18;_a.$3.$M(t,"owaShell");_a.$3.$M(i,"palDownloadManager");_a.$3.$M(r,"userAgent");_a.$3.$M(u,"nativeBridge");_a.$3.$M(f,"messageBoxViewModel");_a.$3.$M(h,"itemStoreGetterFactory");this.$30=n;this.$G=t;this.$Zu=i;this.$1D=r;this.$27=u;this.$1r=f;this.$246=e;this.$1K=o;this.$dj=s;this.$Un=h;this.$v8=c};function $4IA(n,t,i,r,u,f,e,o){var s=this;n.$3R9(t[i],u,f,e,function(s){Array.add(r,s);i<t.length-1?$4IA(n,t,i+1,r,u,f,e,o):o(r)})}function $4IB(n){return n.$1K?n.$1K.$7x("AttachmentsFilePicker"):!1}_at.$Jl.prototype={$G:null,$1D:null,$Zu:null,$27:null,$1r:null,$1K:null,$dj:null,$Un:null,$246:null,$2Ya:null,$9Gd:null,$30:null,$v8:null,$I:function(n,t,i,r){if($4IB(this)&&(_g.$Dr.isInstanceOfType(n)||_g.$5q.isInstanceOfType(n)&&_y.$UW.isInstanceOfType(n.$Hc))){if(!this.$2Ya&&this.$246){var u=this;this.$246.$I(function(n){u.$2Ya=n})}_a.$3.$17(this.$2Ya,"attachmentProviderItemViewModelFactory");return this.$2Ya.$I(n,this.$G,t,i,r,this.$1D)}else if(_g.$5q.isInstanceOfType(n)&&_y.$gW.isInstanceOfType(n.$Hc)){_a.$3.$17(this.$v8,"uriFileAttachmentViewModelFactory");return this.$v8.$I(n,this.$G,t,i,r,this.$1D)}else return new _at.$18(n,this.$G,t,i,r,this.$Zu,this.$30,this.$27,this.$1r,this.$1D,this.$1K,this.$dj,this.$Un)},$3R9:function(n,t,i,r,u){if($4IB(this)&&this.$246&&(_g.$Dr.isInstanceOfType(n)||_g.$5q.isInstanceOfType(n)&&_y.$UW.isInstanceOfType(n.$Hc))){var f=this;var e=function(e){var o=e.$I(n,f.$G,t,i,r,f.$1D);u(o)};this.$246.$I(e)}else{var o=new _at.$18(n,this.$G,t,i,r,this.$Zu,this.$30,this.$27,this.$1r,this.$1D,this.$1K,this.$dj,this.$Un);u(o)}},$72e:function(n,t,i,r,u){if(!n){u(null);return}if(!n.length){u(new Array(0));return}$4IA(this,n,0,new Array(0),t,i,r,u)}};_at.$Tj=function(n,t,i,r,u,f,e,o,s,h,c,l,a){this.$$d_$72f=Function.createDelegate(this,this.$72f);this.$$d_$72i=Function.createDelegate(this,this.$72i);this.$$d_$6tQ=Function.createDelegate(this,this.$6tQ);_at.$Tj.initializeBase(this,[n,t,i,r,u,null,h,null,f,e,c,l,a]);this.$Ol=o;this.$p=s};function $4IE(n,t){var r=null;if(t&&t.ResponseMessages&&t.ResponseMessages.Items&&t.ResponseMessages.Items.length)if(t.ResponseMessages.Items[0].ResponseCode!=="NoError")r="ResponseMessages response code = "+t.ResponseMessages.Items[0].ResponseCode;else{var i=t.ResponseMessages.Items[0];n.$1J.set_$5y(i.Attachments[0].Size);_at.$AU.$5qV(i,n.$1J,n.$71.get_$BV());if(_g.$Dr.isInstanceOfType(n.$1J)&&i.Attachments.length>=1&&i.ResponseCode==="NoError"){var u=i.Attachments[0];u.AttachLongPathName&&n.$1J.set_$243(u.AttachLongPathName);n.$1J.set_$1Q(u.Name)}}else r="The response message received is null";return r}_at.$Tj.prototype={$p:null,$Ol:null,$68X:function(){this.$Ol.$20W(this.get_$Qc(),this.$$d_$6tQ)},$3RA:function(n){this.$68X();_at.$18.prototype.$3RA.call(this,n)},$69L:function(){this.set_$5nk(!1)},$72i:function(n){},$72f:function(n){this.$2bh(n);this.$3RA(null)},$6tQ:function(n){var t=null;var i=n;t=n?$4IE(this,i.Response):"The notification received is null";if(t){i&&(t+=". AttachmentProviderResultCode = "+i.ResultCode);$1Nd(this,1,t,!0)}this.$3RA(null)}};_at.$ov=function(n,t,i,r,u,f,e,o,s,h,c,l,a){_at.$ov.initializeBase(this,[n,t,i,r,u,f,e,o,s,h,c,l,a])};_at.$ov.$2hM=function(){return"UriFileAttachmentNotification"+(_a.$7.get_$2M().$55()+_a.$8B.$33L(0,1e3)).toString()};_at.$ov.prototype={$Dy:null,get_$Qc:function(){this.$Dy||(this.$Dy=_at.$ov.$2hM());return this.$Dy},set_$Qc:function(n){this.$Dy=n;return n},$58C:function(n){if(_g.$5q.isInstanceOfType(this.$1J)&&_y.$gW.isInstanceOfType(this.$1J.$Hc)){_js.Trace.logInfo(_a.$0.$5g,"Uploading attachment from URL");var i=this.$1J.$Hc;this.$Ol.$1L1(this.get_$Qc(),_a.$0.$5g,"UriFileAttachmentViewModel",this.$$d_$6tQ,0);var t=new _at.$xg(this.$71.get_$BV(),i.get_$9Ft(),i.get_$1Q(),this.get_$Qc());t.add_$2A(this.$$d_$72i);t.add_$20(this.$$d_$72f);this.$p.$y(t)}else{_js.Trace.logError(_a.$0.$5g,"Unsupported upload type detected in addFileAttachment");n(null)}}};_at.$vN=function(n,t,i,r,u,f){this.$Ol=n;this.$p=t;this.$30=i;this.$1K=r;this.$dj=u;this.$Un=f};_at.$vN.prototype={$Ol:null,$p:null,$30:null,$1K:null,$dj:null,$Un:null,$I:function(n,t,i,r,u,f){return new _at.$ov(n,t,i,r,u,null,f,this.$Ol,this.$p,this.$30,this.$1K,this.$dj,this.$Un)}};_at.$E6=function(n){this.$1n=n;this.$2Ep={};this.$1Hi=new(_0365f.$s.$$(_at.$P0))};function $3DP(n,t){_a.$3.$M(t,"parameter");_a.$3.$M(t.$7s,"AttachmentId")}function $1dg(n,t,i){}_at.$E6.prototype={$1n:null,$2Ep:null,$1Hi:null,get_$F:function(){return this.$1Hi.get_$F()},$6l:function(n){_a.$3.$1C(n,"attachmentId");return n in this.$2Ep},$H:function(n){$3DP(this,n);if(!this.$6l(n.$7s)){$1dg(this,"FastLookupQueue. Adding {0}",n);this.$1Hi.$H(n);this.$2Ep[n.$7s]=""}},$6z:function(n,t){$3DP(this,t);if(!this.$6l(t.$7s)){$1dg(this,"FastLookupQueue. InsertAt {0}",t);this.$1Hi.$9HX(n,t);this.$2Ep[t.$7s]=""}},$79Q:function(){$1dg(this,"FastLookupQueue. DeQueue. Current count {0}",this.get_$F());if(this.get_$F()>0){var n=this.$1Hi.get_$48(0);this.$3Q(n);return n}else return null},$3Q:function(n){$3DP(this,n);$1dg(this,"FastLookupQueue. Remove. Current count {0}",this.get_$F());if(this.$6l(n.$7s)){$1dg(this,"FastLookupQueue. Remove. Found {0}",n);delete this.$2Ep[n.$7s];for(var i=-1,t=0;t<this.$1Hi.get_$F();t++)if(this.$1Hi.get_$48(t).$7s===n.$7s){i=t;break}if(i!==-1){this.$1Hi.$67(i);$1dg(this,"FastLookupQueue. Returning from remove after removal. Current Count {0}",this.get_$F())}}}};_at.$Ac=function(){};_at.$Ac.$8hv=function(n,t,i,r,u,f,e){_a.$3.$M(n,"initNativeBridge");_a.$3.$M(t,"initClientStore");_a.$3.$M(i,"initAttachmentInfoRecord");_a.$3.$1C(r,"initMimeType");_a.$3.$1C(u,"fileName");_a.$3.$M(f,"initOnOpenAttachmentSuccess");_a.$3.$M(e,"initOnOpenAttachmentError");if(_at.$Ac.$2nZ){_js.Trace.logInfo(_at.$Ac.$D,"Already opening an attachment so returning.");return}_js.Trace.logInfo(_at.$Ac.$D,"OpenAttachment with record DataID {0}, Size {1}, id {2}",i.AttachmentId,i.DataID,i.Size);_at.$Ac.$2nZ=!0;n.$9I.$8hz(i.DataID,r,u,function(n){_at.$Ac.$8bU(n,i,t,f,e)});t.$4z9(i.AttachmentId,function(n){},null)};_at.$Ac.$7K0=function(n){var t=null;switch(n){case 0:break;case 1:case 3:t=_u.Strings.l_UnableToFindActivity_Text;break;case 2:t=_u.Strings.l_DownloadAttachmentAgain_Text;break;default:break}_js.Trace.logInfo(_at.$Ac.$D,"OpenPalAttachment error code {0}, string: {1}",n,t);return t};_at.$Ac.$8bU=function(n,t,i,r,u){_at.$Ac.$2nZ=!1;var f=!0;switch(n){case 0:f=!1;break;case 1:case 3:break;case 2:i.$4rd(t.AttachmentId);break;default:break}if(f){_js.Trace.logWarning(_at.$Ac.$D,"OnOpenDocument failed with errorCode {0}",n);u(n)}else{_js.Trace.logInfo(_at.$Ac.$D,"OnOpenDocument succeeded");r()}};_at.$2K=function(n,t,i){this.$$d_$8VR=Function.createDelegate(this,this.$8VR);this.$$d_$8ag=Function.createDelegate(this,this.$8ag);this.$$d_$5kX=Function.createDelegate(this,this.$5kX);_a.$3.$M(n,"initNativeBridge");var r=t?t.get_$4B1():null;this.$27=n;this.$3PM=i;this.$2x=_a.UserAgent.getInstance().$3hk(r,n);$4IH(this,t)};_at.$2K.get_$L=function(){if(!_at.$2K.$g){var n=_bc.$Ul.isInstanceOfType(_g.$1Q.$g)?_g.$1Q.$g:null;_at.$2K.$g=new _at.$2K(_a.NativeBridge.get_$L(),n?n.get_$95().get_$1Cz():null,n?n.get_$6tW():null)}return _at.$2K.$g};function $6EK(n,t){var i=null;switch(t){case 0:break;case 7:break;case 3:i=_u.Strings.l_SpeechInvalidCredentials_Text;break;case 8:break;case 1:case 4:var r=this,u=this;n.$3PM.$6xr(n.$64,n.$27,function(){_js.Trace.logInfo(_at.$2K.$D,"Successfully completed CleanAllPalAttachmentInfoAndAttachments")},function(n){_js.Trace.logWarning(_at.$2K.$D,"CleanAllPalAttachmentInfoAndAttachments failed due to error {0}",n)});i=_u.Strings.l_SpeechServerBusy_Text;break;case 5:i=_u.Strings.l_SpeechNoNetworkAction_Text;break;case 6:i=_u.Strings.l_SpeechServerBusy_Text;break;case 9:i=_u.Strings.l_UnableToDownload_Text;break;case 2:i=_u.Strings.l_UnknownDataIDType_Text;break;default:break}return i}function $4IH(n,t){if(n.$2x){n.$64=t;n.$la=new _at.$E6(_at.$2K.$D);n.$1jK={};n.$vp=null;n.$H7=null;n.$2cE=0}}function $4IG(n){_js.Trace.logInfo(_at.$2K.$D,"CancelCurrentDownload, canceling the current download");n.$27.$108.$6wH();n.$vp=n.$H7;n.$H7=null}function $2T8(n){_js.Trace.logInfo(_at.$2K.$D,"Inside StartDownloadInternal");if(n.$vp)_js.Trace.logInfo(_at.$2K.$D,"Still waiting for the canceled download to get canceled.");else if(n.$H7)_js.Trace.logInfo(_at.$2K.$D,"Still waiting for the current download to finish.");else{_js.Trace.logInfo(_at.$2K.$D,"StartDownloadInternal, pending items in queue {0}",n.$la.get_$F());n.$H7=n.$la.$79Q();n.$2cE=0;if(n.$H7){_js.Trace.logInfo(_at.$2K.$D,"Starting download {0}",n.$H7);$1Bp(n,n.$H7,3);var t=this;n.$3PM.$96H(n.$64,n.$27,n.$$d_$5kX,function(t){_js.Trace.logWarning(_at.$2K.$D,"Scheduled cleanup failed due to error {0}",t);n.$5kX()})}else _js.Trace.logInfo(_at.$2K.$D,"Download queue is empty.")}}function $1Bp(n,t,i){var r=this;$2T7(n,t,function(n){n.$1Yp(i)})}function $4II(n,t,i){var r=this;$2T7(n,t,function(n){_js.Trace.logWarning(_at.$2K.$D,"Raising OnError event with error {0} for attachment {1}",i,t);n.$TR(i)})}function $2T7(n,t,i){var r=n.$1jK[t.$7s];r&&i(r)}function $6EL(n,t){var i=null;if(_bc.$BG.$59N(t.$7s)){_js.Trace.logInfo(_at.$2K.$D,"The attachment is not uploaded to the server yet. {0}",t);i=_u.Strings.l_AttachmentOfflineViewingUnsupported_Text}else if(_js.$8.$c(t.$40Q)){_js.Trace.logInfo(_at.$2K.$D,"Attachment is a quick message {0}",t);i=_u.Strings.l_AttachmentOfflineViewingUnsupported_Text}else if(_js.$8.$c(t.$1Xa)){_js.Trace.logInfo(_at.$2K.$D,"Attachment does not have content type set. {0}",t);i=_u.Strings.l_UnknownDataIDType_Text}else if(_js.$8.$c(t.$rE)){_js.Trace.logInfo(_at.$2K.$D,"Attachment does not have a valid file name {0}.",t);i=_u.Strings.l_UnknownDataIDType_Text}else if(n.$la.get_$F()===10){_js.Trace.logInfo(_at.$2K.$D,"download queue max size reached. Rejecting attachment with params {0}.",t);i=String.format(_u.Strings.l_DownloadAttachmentQueueMaxSizeReached_Text,10)}return i}function $6EJ(n,t,i){if(n.$H7&&t===n.$H7.$7s){_js.Trace.logInfo(_at.$2K.$D,"FindStatusAndFireCallback. currently downloading attachment with id {0}",t);i.$1Yp(3)}else if(n.$la.$6l(t)){_js.Trace.logInfo(_at.$2K.$D,"FindStatusAndFireCallback. Found in the queue. attachment with id {0}",t);i.$1Yp(2)}else{var r=this,u=this;n.$64.$5v1(t,function(n){if(n){_js.Trace.logInfo(_at.$2K.$D,"FindStatusAndFireCallback Found the record in db {0} and AttachmentId {1}",n.DataID,n.AttachmentId);i.$1Yp(4);i.$5fv(n)}else{_js.Trace.logInfo(_at.$2K.$D,"FindStatusAndFireCallback. Did not find attachment with id {0} in the db.",t);i.$1Yp(1)}},function(n){_js.Trace.logWarning(_at.$2K.$D,"FindStatusAndFireCallback. Got error {0} from DB while retreiving record with id {1}",n,t);i.$1Yp(1)})}}_at.$2K.prototype={$2x:!1,$la:null,$H7:null,$vp:null,$2cE:0,$1jK:null,$27:null,$3PM:null,$64:null,get_$ky:function(){if(!this.$2x&&_g.$1Q.$g){var n=_bc.$Ul.isInstanceOfType(_g.$1Q.$g)?_g.$1Q.$g:null;this.$2x=_a.UserAgent.getInstance().$3hk(n?n.get_$57():null,this.$27);$4IH(this,n?n.get_$95().get_$1Cz():null)}return this.$2x},$HX:function(n,t){_a.$3.$1C(n,"attachmentId");_a.$3.$M(t,"callbacks");if(this.get_$ky()){this.$1jK[n]=t;$6EJ(this,n,t)}else _js.Trace.logInfo(_at.$2K.$D,"PAL does not support download.")},$20X:function(n){_a.$3.$1C(n,"attachmentId");this.get_$ky()&&n in this.$1jK&&delete this.$1jK[n]},$4tk:function(n){_a.$3.$M(n,"parameters");_a.$3.$M(n.$7s,"AttachmentId");_a.$3.$M(n.$OL,"DownloadUrl");_js.Trace.logInfo(_at.$2K.$D,"DownloadAttachment:Begin download Attachment for parameters {0}",n);if(this.get_$ky()){if(!(n.$7s in this.$1jK))throw Error.invalidOperation("Subscribe must be called before calling DownloadAttachment.");var t=$6EL(this,n);if(_js.$8.$c(t)){if((!this.$H7||this.$H7.$7s!==n.$7s)&&!this.$la.$6l(n.$7s)){_js.Trace.logInfo(_at.$2K.$D,"Starting download for {0}",n);if(n.$5Ad){this.$la.$6z(0,n);if(this.$H7){$4IG(this);this.$la.$6z(1,this.$vp);$1Bp(this,this.$vp,2)}else{$1Bp(this,n,2);$2T8(this)}}else{this.$la.$H(n);$1Bp(this,n,2);$2T8(this)}}}else $4II(this,n,t)}},$AQ:function(n){_a.$3.$M(n,"parameters");_a.$3.$M(n.$7s,"AttachmentId");_js.Trace.logInfo(_at.$2K.$D,"Cancel download for parameters {0}",n);if(this.get_$ky())if(this.$la.$6l(n.$7s)){this.$la.$3Q(n);_js.Trace.logInfo(_at.$2K.$D,"Found and removed from queue {0}. Pending Items in queue {1}",n,this.$la.get_$F());$1Bp(this,n,1)}else if(this.$H7&&this.$H7.$7s===n.$7s){_js.Trace.logInfo(_at.$2K.$D,"Current Download was canceled. {0}",this.$H7);$4IG(this);$1Bp(this,this.$vp,1)}},$5kX:function(){_js.Trace.logInfo(_at.$2K.$D,"Starting the download now for {0}",this.$H7);if(this.$vp){this.$vp=null;$2T8(this)}else this.$27.$108.$7B4(this.$H7.$OL,1,this.$H7.$rE,this.$H7.$1Xa,this.$$d_$8ag,this.$$d_$8VR)},$8ag:function(n){if(this.$H7){this.$2cE+=n;var t=this;$2T7(this,this.$H7,function(n){n.$5h3(t.$2cE)})}},$8VR:function(n,t,i){_js.Trace.logInfo(_at.$2K.$D,"OnDownloadComplete with errorCode = {0} httpStatusCode = {1} dataID = {2} for attachment {3}",n,t,i,this.$H7);if(this.$vp)this.$vp=null;else if(n||t!==200){var f=$6EK(this,n);_js.$8.$c(f)||$4II(this,this.$H7,f);$1Bp(this,this.$H7,1)}else{var r=this.$H7;var u=new AttachmentInfoRecord(this.$H7.$7s,i,this.$H7.$3MG,_a.$7.get_utcNow().$55(),this.$H7.$40Q,0,_a.$7.$7HH(_a.$7.get_utcNow()),!0);var e=this,o=this;this.$64.$5wI(u,function(n){_js.Trace.logInfo(_at.$2K.$D,"Successfully saved attachment in DB with dataID {0} and parameters {1}",i,r)},function(n){_js.Trace.logWarning(_at.$2K.$D,"Unable to save the attachment in DB with parameters {0} error {1}",r,n)});$1Bp(this,r,4);var s=this;$2T7(this,r,function(n){_js.Trace.logInfo(_at.$2K.$D,"Raising OnAttachmentInfoRecordAvailable with record {0} for attachment {1}",u,r);n.$5fv(u)})}this.$H7=null;$2T8(this)}};_at.$P0=function(){};_at.$P0.$75M=function(n){_a.$3.$M(n,"viewModel");_a.$3.$M(n.$OL,"DownloadUrl should not be empty");var t=null;n.$71&&n.$71.get_$BV()&&(t=n.$71.get_$BV().Id);return _at.$P0.$4p3(n.$1J,n.$1J.get_$1Q(),n.$1J.get_$BL(),n.$OL,t,!1)};_at.$P0.$4p3=function(n,t,i,r,u,f){_a.$3.$M(n,"attachment");_a.$3.$M(n.get_$40(),"attachmentId");_a.$3.$M(r,"downloadUrl");_a.$3.$M(r,"destinationFileName");var e=new _at.$P0;e.$7s=n.get_$40().Id;e.$3MG=n.get_$5y();e.$1F9=t;e.$rE=_a.$8h.$eZ(e.$1F9);e.$1Xa=i;e.$OL=_a.Uri.$453(r);e.$40Q=u;e.$5Ad=f;_js.$8.$c(e.$1Xa)&&!_a.UserAgent.getInstance().$Wz&&(e.$1Xa="fakeMimeType");return e};_at.$P0.prototype={$1Xa:null,$1F9:null,$rE:null,$7s:null,$40Q:null,$OL:null,$3MG:0,$5Ad:!1,toString:function(){return String.format("Attachment with Name {0} Size {1} ContentType {2} AttachmentId{3}",this.$1F9,this.$3MG,this.$1Xa,this.$7s)}};var IWellKnownFileTypes=function(){};IWellKnownFileTypes.registerInterface("IWellKnownFileTypes");_at.$pB=function(){};_at.$pB.prototype={$39:function(n,t){return String.format(_u.Strings.l_AttachmentParenthesisFormat_Text,n)},$4nO:function(n,t){throw Error.notImplemented();}};_at.$yj=function(){};_at.$yj.prototype={};_at.$yj.registerEnum("_at.$yj",!1);_at.$pL=function(){};_at.$pL.prototype={$39:function(n,t){var i=n;var r=_js.$2B.$jX(_a.$pK,t.toString());return i!==r},$4nO:function(n,t){throw Error.notImplemented();}};_at.$pW=function(){};_at.$pW.prototype={$39:function(n,t){var i=n;return!i||!i.$1J?"":_js.$8.$c(i.$1J.get_$3AC())?i.get_$mD():"data:"+i.$1J.get_$66C()+";base64,"+i.$1J.get_$3AC()},$4nO:function(n,t){throw Error.notImplemented();}};_at.$td=function(){};_at.$td.prototype={$39:function(n,t){var i=n;var r=!0;try{var u=_js.$2B.$jX(_at.$yj,t.toString());switch(u){case 1:i&&i!==1||(r=!1);break;case 2:i&&i!==1&&i!==4||(r=!1);break;case 3:i===3&&(r=!1);break;case 4:(i===3||i===2)&&(r=!1);break;case 5:i===2&&(r=!1);break;case 6:i!==1&&i||(r=!1);break}}catch(f){r=!0}return r},$4nO:function(n,t){throw Error.notImplemented();}};_at.$xg.registerClass("_at.$xg",_h.$Im.$$(String));AttachmentsComponent.registerClass("AttachmentsComponent",null,_a.$1C3);_at.$3R.registerClass("_at.$3R",_b.$HX);_at.$5V.registerClass("_at.$5V");_at.$wG.registerClass("_at.$wG");_at.$r1.registerClass("_at.$r1",null,_at.$1Bw);_at.$r2.registerClass("_at.$r2");_at.$AU.registerClass("_at.$AU",_h.$I3.$$(_g.$QP,_g.$Wl));_at.$xi.registerClass("_at.$xi",_at.$AU);_at.$yC.registerClass("_at.$yC",_h.$I3.$$(_g.$QS,_g.$Xs));_at.$Yu.registerClass("_at.$Yu",_h.$I3.$$(_g.$Tv,_g.$Wl));_at.$Mo.registerClass("_at.$Mo",_h.$Im.$$(String));_at.$wE.registerClass("_at.$wE",_a.$T);_at.$wE.prototype.$J7=_a.$T.prototype.$J7;_at.$BU.registerClass("_at.$BU");_at.$wF.registerClass("_at.$wF",_a.$T);_at.$wF.prototype.$J7=_a.$T.prototype.$J7;_at.$wI.registerClass("_at.$wI",_a.$T);_at.$wI.prototype.$J7=_a.$T.prototype.$J7;_at.$wK.registerClass("_at.$wK",_a.$T);_at.$wK.prototype.$J7=_a.$T.prototype.$J7;_at.$EU.registerClass("_at.$EU");_at.$wN.registerClass("_at.$wN",_a.$T);_at.$wN.prototype.$J7=_a.$T.prototype.$J7;_at.$18.registerClass("_at.$18",_a.$ER,_at.$1Bx,_y.$lQ,_js.$sJ);_at.$Jl.registerClass("_at.$Jl",null,IAttachmentViewModelFactory);_at.$Tj.registerClass("_at.$Tj",_at.$18);_at.$ov.registerClass("_at.$ov",_at.$Tj);_at.$vN.registerClass("_at.$vN",null,IUriFileAttachmentViewModelFactory);_at.$E6.registerClass("_at.$E6");_at.$Ac.registerClass("_at.$Ac");_at.$2K.registerClass("_at.$2K",null,_at.$sP);_at.$P0.registerClass("_at.$P0");_at.$pB.registerClass("_at.$pB",null,_js.$1CF);_at.$pL.registerClass("_at.$pL",null,_js.$1CF);_at.$pW.registerClass("_at.$pW",null,_js.$1CF);_at.$td.registerClass("_at.$td",null,_js.$1CF);_at.$3R.$3MC=new _H("Attachment",_g.Attachment,_at.$3R);_at.$3R.$40O=new _H("ParentItemId",_g.$1j,_at.$3R);_at.$3R.$16M=new _H("IsEnabled",Boolean,_at.$3R);_at.$3R.$3Xf=new _H("FileSelectedCommand",_js.$CG,_at.$3R);_at.$3R.$3Bx=new _H("UploadAttachmentCommand",_js.$CG,_at.$3R);_at.$3R.$4FV=new _H("UploadCompletedCommand",_js.$CG,_at.$3R);_at.$3R.$D=_a.$0.$1e;_at.$5V.$g=null;_at.$AU.$D=_a.$0.$1e;_at.$Yu.$D=_a.$0.$1e;_at.$BU.$2jg=null;_at.$18.$D=_a.$0.$1e;_at.$Ac.$D=_a.$0.$1e;_at.$Ac.$2nZ=!1;_at.$2K.$D=_a.$0.$1e;_at.$2K.$g=null