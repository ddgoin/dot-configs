define(["core/Logger","core/vendor/jquery.min","core/vendor/DropletJS.Class.min","core/vendor/DropletJS.PubSub.min","core/vendor/Brightline.min","core/vendor/text!components/Popup/popup.tpl"],function(e,t,n,r,i,s){function u(){return chrome.extension.getBackgroundPage()}return n.create({model:null,construct:function(e){this.model=e,r.listen("Popup.timer.tick",this.updateDisplayTimer.bind(this))},init:function(){this.render(),this.bindUIHandlers(),this.addListeners()},render:function(){var e=new i(s);e.set("baseDomain",this.model.baseDomain),e.set("fullDomain",this.model.fullDomain),t("body").append(e.render()),u().StayFocusd.getLocal("hideAllowSiteLink")=="true"?t(".allow").hide():t("#allow-entire").show(),this.model.fullDomain!==this.model.baseDomain&&t(".only-allow, .only-block").show(),u().StayFocusd.localizeHTML(document)},bindUIHandlers:function(){var e=this;t("#show-help").click(function(){r.publish("PopupView.button.clicked",{button:"help"})}),t("#show-options").click(function(){r.publish("PopupView.button.clicked",{button:"options"})}),t("#show-nuclear-option").click(function(){r.publish("PopupView.button.clicked",{button:"nuclearOption"})}),t("a.close").click(function(){r.publish("PopupView.button.clicked",{button:"close"})}),t("#showBlockedSitesOptions").click(function(){r.publish("PopupView.button.clicked",{button:"blockedSites"})}),t("#show-advanced-options").click(function(){t("#advanced-options").slideToggle("fast")}),t("#block-entire").click(function(){r.publish("PopupView.button.clicked",{button:"addToList",domain:e.model.baseDomain,listType:"black"})}),t("#block-custom").click(function(){r.publish("PopupView.button.clicked",{button:"addToList",domain:t("#custom-url").val(),listType:"black"})}),t("#allow-custom").click(function(){r.publish("PopupView.button.clicked",{button:"addToList",domain:t("#custom-url").val(),listType:"white"})}),t("#allow-entire").click(function(){r.publish("PopupView.button.clicked",{button:"addToList",domain:e.model.baseDomain,listType:"white"})}),t("#only-block").click(function(){r.publish("PopupView.button.clicked",{button:"addToList",domain:e.model.fullDomain,listType:"black"})}),t("#only-allow").click(function(){r.publish("PopupView.button.clicked",{button:"addToList",domain:e.model.fullDomain,listType:"white"})})},addListeners:function(){var e=this;r.listen("*.domain.added",function(t,n){e.showAddToListStatus(n.success)}),r.listen("PopupModel.timer.updated",function(t,n){e.updateDisplayTimer(n.timer)})},showAddToListStatus:function(e){e===!0?(t("#status-msg").removeClass("error").addClass("success").html(chrome.i18n.getMessage("success").toUpperCase()+"!"),setTimeout(function(){window.close()},1500)):(t("#status-msg").removeClass("success").addClass("error").html(chrome.i18n.getMessage("error").toUpperCase()),setTimeout(function(){t("#status-msg").hide()},2e3)),t("#status-msg").show()},updateDisplayTimer:function(e){var n="";this.model.isNuclear()?(n=chrome.i18n.getMessage("nuclear"),t("#display-timer").addClass("nuclear")):this.model.isActive()===!1?n=chrome.i18n.getMessage("inactive"):(n=e,n=="00:00:00"&&t("#display-timer").addClass("expired")),t("#display-timer").html(n)}})});