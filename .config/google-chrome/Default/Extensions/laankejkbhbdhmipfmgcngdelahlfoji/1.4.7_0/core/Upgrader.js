function bg(){return chrome.extension.getBackgroundPage()}define(["core/Logger","core/vendor/jquery.min"],function(e,t){var r={currentVersion:null,upgradeStack:[],log:function(t,n,r,i){},init:function(){this.loadManifest()},loadManifest:function(){var e=this;t.ajax({type:"GET",url:chrome.extension.getURL("manifest.json"),data:null,success:function(t){var n=JSON.parse(t);r.currentVersion=n.version,r.loadUpgrades()}})},loadUpgrades:function(){var e=this;t.ajax({type:"GET",url:chrome.extension.getURL("upgrades/upgrades.json"),data:null,success:function(t){var n=JSON.parse(t);r.isNewVersion()&&(r.upgradeStack=r.buildUpgradeStack(n.versions),r.doNextUpgrade())}})},buildUpgradeStack:function(e){var t=this.getLastVersion(),n=this.getCurrentVersion(),r=!1,i=[];for(var s in e)e.hasOwnProperty(s)&&(r=s>t&&s<=n,r&&i.push(e[s]));return i},doNextUpgrade:function(){var e=this.upgradeStack.shift();e?this.doUpgrade(e):this.endUpgrades()},doUpgrade:function(e){if(typeof e=="undefined")this.doNextUpgrade();else{var t=document.createElement("script");t.type="text/javascript",t.src="upgrades/"+e,t.onload=r.doNextUpgrade.bind(r),document.getElementsByTagName("head")[0].appendChild(t)}},endUpgrades:function(){this.setLocal("version",this.getCurrentVersion())},getCurrentVersion:function(){return this.currentVersion},getLastVersion:function(){return this.getLocal("version")},isNewVersion:function(){var e=this.getCurrentVersion(),t=this.getLastVersion();return e!==t},setLocal:function(e,t){localStorage.setItem(e,t)},getLocal:function(e){return localStorage.getItem(e)},removeLocal:function(e){return localStorage.removeItem(e)}};return r});