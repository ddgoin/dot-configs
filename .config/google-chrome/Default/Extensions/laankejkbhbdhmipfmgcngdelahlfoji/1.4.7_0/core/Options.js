function bg(){return chrome.extension.getBackgroundPage()}define(["core/Logger","core/DateUtils","core/vendor/jquery.min","core/vendor/jquery.simplemodal.min"],function(e,t,n){var i={challengeKeyCounter:0,defaultChallengeText:chrome.i18n.getMessage("defaultChallengeText"),log:function(t,n,r,i){},init:function(){n("a.close").click(function(){window.open("","_self",""),window.close()}),this.initNav(),this.initChallenge(),this.initMaxTimeAllowed(),this.initActiveDays(),this.initActiveHours(!0),this.initResetTime(!0),this.initBlockedSites(),this.initAllowedSites(),this.initNuclearOption(!0),this.initCustomizeInterface(),this.initImportExport()},initNav:function(){var e=this;n("#nav li").click(function(){var t=n(this).attr("class"),r=t.split(" ");e.selectNav(r[0])});if(window.location.hash){var t=window.location.hash.replace("#","");t=t.replace("Tab",""),this.selectNav(t)}else this.selectNav("maxTimeAllowed")},selectNav:function(e){n("#nav li").removeClass("active"),n(".option.active").hide(),n("#body ."+e).show(),n("."+e).addClass("active"),window.location.hash="#"+e+"Tab"},addToBlacklist:function(e,t){var r=bg().ListManager.addToBlacklist(e),i=this;if(r){n("#"+t).remove(),n("#blockedNoSitesYet").remove();var s=this.addBlockedSiteToListHTML(e,t);n("#blockedSitesList").append(s),n("#"+t+" img").click(function(){i.removeFromList(e,t,"black")}),bg().StayFocusd.isProductivityBypassActive()&&n(".hideOnBypass").hide()}},removeFromList:function(e,t,r){var i=!1;if(r=="black"){if(bg().NuclearOption.isActive()&&bg().NuclearOption.getBlockType()=="blocked")return alert(chrome.i18n.getMessage("cannotRemoveBlockedSiteDuringNuclearOption")),!1;i=bg().ListManager.removeFromBlacklist(e)}else i=bg().ListManager.removeFromWhitelist(e);i&&n("#"+t).slideUp("fast")},initMaxTimeAllowed:function(){var e=this;n("#maxTimeAllowed").keydown(function(t){e.allowOnlyNumbers(t)}),bg().StayFocusd.isMaxTimeAllowedExceeded()&&(n("#maxTimeAllowed").attr("disabled","disabled"),n("#maxTimeAllowedButton").attr("disabled","disabled"),n("#maxTimeAllowedMsg").html(chrome.i18n.getMessage("timeExpiredCannotChangeUntilTomorrow")),n("#maxTimeAllowedMsg").show())},setMaxTimeAllowed:function(e){var t=bg().StayFocusd.setMaxTimeAllowed(e);t===!1&&n("#maxTimeAllowed").val(bg().StayFocusd.getMaxTimeAllowed())},initActiveDays:function(){var e=bg().StayFocusd.getActiveDays(),t=new Date,r=t.getDay(),i=this;n(".activeDay").each(function(){var t=n(this),i=t.val();e.inArray(i)===!0&&t.attr("checked","checked"),i==r&&(t.attr("checked")?t.attr("disabled","disabled"):t.click(function(){t.attr("disabled","disabled")}))}),n(".activeDay").click(function(){i.setActiveDays()})},setActiveDays:function(){var e=[],t=new Date,r=t.getDay();n(".activeDay:checked").each(function(){var t=parseInt(n(this).val(),10);t==r&&n(this).attr("disabled","disabled"),e.push(t)}),bg().StayFocusd.setActiveDays(e)},initActiveHours:function(e){var r=this;e===!0&&n("#setActiveHours").click(function(){r.setActiveHours()});var i=bg().StayFocusd.getActiveHours(),s=t.parseMilitaryTime(i.startTime),o=t.parseMilitaryTime(i.endTime);n(".start .hour").val(s.hour).attr("selected","selected"),n(".start .min").val(s.min).attr("selected","selected"),n(".start .ampm").val(s.ampm).attr("selected","selected"),n(".end .hour").val(o.hour).attr("selected","selected"),n(".end .min").val(o.min).attr("selected","selected"),n(".end .ampm").val(o.ampm).attr("selected","selected");var u=bg().StayFocusd.getActiveHoursQueue();if(u!=0){var a=parseInt(u.timestamp,10);s=u.startTime,o=u.endTime;var f=new Date(a),l=f.getMonth(),c=f.getDate(),h=f.getFullYear(),p=f.getHours(),d=f.getMinutes(),v=chrome.i18n.getMessage("timeAM");p==0&&(p=12,v=chrome.i18n.getMessage("timeAM")),p>=12&&(p=p==12?12:p-12,v=chrome.i18n.getMessage("timePM")),d=t.toTwoDigits(d);var m=[chrome.i18n.getMessage("january"),chrome.i18n.getMessage("february"),chrome.i18n.getMessage("march"),chrome.i18n.getMessage("april"),chrome.i18n.getMessage("may"),chrome.i18n.getMessage("june"),chrome.i18n.getMessage("july"),chrome.i18n.getMessage("august"),chrome.i18n.getMessage("september"),chrome.i18n.getMessage("october"),chrome.i18n.getMessage("november"),chrome.i18n.getMessage("december")],g=t.parseMilitaryTime(s),y=t.parseMilitaryTime(o),b=m[l]+" "+c+", "+h,w=p+":"+d+" "+v,E=chrome.i18n.getMessage("initActiveHoursMsg",[b,w,g.display,y.display]);n("#activeHoursMsg").html(E),n("#activeHoursMsg").show()}},setActiveHours:function(){var e=[chrome.i18n.getMessage("january"),chrome.i18n.getMessage("february"),chrome.i18n.getMessage("march"),chrome.i18n.getMessage("april"),chrome.i18n.getMessage("may"),chrome.i18n.getMessage("june"),chrome.i18n.getMessage("july"),chrome.i18n.getMessage("august"),chrome.i18n.getMessage("september"),chrome.i18n.getMessage("october"),chrome.i18n.getMessage("november"),chrome.i18n.getMessage("december")],r=new Date,i=r.getMonth(),s=r.getDate(),o=r.getFullYear();s=t.toTwoDigits(s);var u=e[i]+" "+s+", "+o,a=n(".start .hour").val(),f=n(".start .min").val(),l=n(".start .ampm").val(),c=a==0?12:a;l=="pm"&&(a=parseInt(a,10)+12);var h=a+":"+f,p=new Date(u+" "+h+":00"),d=p.getTime(),v=n(".end .hour").val(),m=n(".end .min").val(),g=n(".end .ampm").val(),y=v==0?12:v;g=="pm"&&(v=parseInt(v,10)+12);var b=v+":"+m,w=new Date(u+" "+b+":00"),E=w.getTime(),S=!0;if(E<=d){var x=c+":"+f+" "+l.toUpperCase(),T=y+":"+m+" "+g.toUpperCase();S=confirm(chrome.i18n.getMessage("activeOverMidnight",[x,T]))}S&&(bg().StayFocusd.setActiveHoursQueue(h,b),bg().StayFocusd.isFirstInstallAllowanceActive()===!1?alert(chrome.i18n.getMessage("activeHoursQueued")):alert(chrome.i18n.getMessage("activeHoursSet"))),this.initActiveHours()},initResetTime:function(e){var r=this;e===!0&&n("#setResetTime").click(function(){r.setResetTime()});var i=bg().StayFocusd.getResetTime(),s=t.parseMilitaryTime(i);n(".reset .hour").val(s.hour).attr("selected","selected"),n(".reset .min").val(s.min).attr("selected","selected"),n(".reset .ampm").val(s.ampm).attr("selected","selected");var o=bg().StayFocusd.getResetTimeQueue();if(o!=0){var u=parseInt(o.timestamp,10);i=o.resetTime;var a=new Date(u),f=a.getMonth(),l=a.getDate(),c=a.getFullYear(),h=a.getHours(),p=a.getMinutes(),d=chrome.i18n.getMessage("timeAM");h==0&&(h=12,d=chrome.i18n.getMessage("timeAM")),h>=12&&(h=h==12?12:h-12,d=chrome.i18n.getMessage("timePM")),p=t.toTwoDigits(p);var v=[chrome.i18n.getMessage("january"),chrome.i18n.getMessage("february"),chrome.i18n.getMessage("march"),chrome.i18n.getMessage("april"),chrome.i18n.getMessage("may"),chrome.i18n.getMessage("june"),chrome.i18n.getMessage("july"),chrome.i18n.getMessage("august"),chrome.i18n.getMessage("september"),chrome.i18n.getMessage("october"),chrome.i18n.getMessage("november"),chrome.i18n.getMessage("december")];s=t.parseMilitaryTime(i);var m=v[f]+" "+l+", "+c,g=h+":"+p+" "+d,y=chrome.i18n.getMessage("initResetTimeMsg",[m,g,s.display]);n("#resetTimeMsg").html(y),n("#resetTimeMsg").show()}},setResetTime:function(){var e=n(".reset .hour").val(),t=n(".reset .min").val(),r=n(".reset .ampm").val();r=="pm"&&(e=parseInt(e,10)+12);var i=e+":"+t;bg().StayFocusd.setResetTimeQueue(i),bg().StayFocusd.isFirstInstallAllowanceActive()===!1?alert(chrome.i18n.getMessage("dailyResetQueued")):alert(chrome.i18n.getMessage("dailyResetSet")),this.initResetTime()},initBlockedSites:function(){var e=this;this.createBlockedSitesListHTML(),bg().StayFocusd.isMaxTimeAllowedExceeded()&&(n("#blockedSitesMsg").html(chrome.i18n.getMessage("cannotRemoveBlockedSites")),n("#blockedSitesMsg").show()),n("input[name=addBlockedSites]").click(function(){e.addBlockedSites()}),n("input[name=stalkerOption]").click(function(){e.toggleOutgoingLinksOption()}),n("#showSuggestedSitesList").click(function(){e.getSuggestedSitesList()}),n("#blockExtensionsPage").click(function(){bg().ListManager.addToBlacklist("chrome://extensions"),e.createBlockedSitesListHTML()}),bg().StayFocusd.isOutgoingLinksOptionActive()&&(n("input[name=stalkerOption]").attr("checked","checked"),bg().StayFocusd.isMaxTimeAllowedExceeded()&&n("input[name=stalkerOption]").attr("disabled","disabled"))},toggleOutgoingLinksOption:function(){bg().StayFocusd.isOutgoingLinksOptionActive()?bg().StayFocusd.setLocal("countdownForOutgoingLinks","false"):bg().StayFocusd.setLocal("countdownForOutgoingLinks","true")},getSuggestedSitesList:function(){var e=this;n.ajax({type:"GET",url:bg().StayFocusd.apiURL+"/SiteList/suggestions/black.json",data:null,success:function(t){var n=JSON.parse(t);if(n.count===0||n.data==undefined)return alert(chrome.i18n.getMessage("errorLoadingSuggestedSites")),!1;e.addSuggestedSitesToList(n.data)},error:function(e){return alert(chrome.i18n.getMessage("errorLoadingSuggestedSites")),!1}})},addSuggestedSitesToList:function(e){var t=this;for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(bg().ListManager.isBlacklisted(i))continue;var s=r.split(" ").join("-").toLowerCase(),o='<li id="'+s+'"><img src="common/img/add_10x10.png" title="'+chrome.i18n.getMessage("addSiteToBlockedSitesList",r)+'" alt="'+chrome.i18n.getMessage("addToList")+'"> '+r+"</li>";n("#suggestedSitesList").append(o),function(e,r){n("#"+r+" img").click(function(){t.addToBlacklist(e,r,"black")})}(i,s)}n("#suggestedSites").slideToggle()},addBlockedSites:function(){var e=n("#newBlockedSites").val();if(e!==""){var t=e.split("\n");for(var r=0;r<t.length;r++){var i=t[r];if(i.length==0)continue;bg().ListManager.addToBlacklist(i)}n("#blockedSitesList").html(""),n("#allowedSitesList").html(""),this.createBlockedSitesListHTML(),this.createAllowedSitesListHTML(),n("#newBlockedSites").val("")}},createBlockedSitesListHTML:function(){n("#blockedSitesList").html("");var e=this,t=bg().ListManager.getBlacklistedDomains();if(t.length===0)n("#blockedSitesList").append('<li id="blockedNoSitesYet"><i>'+chrome.i18n.getMessage("noSitesYet")+"</i></li>");else for(var r=0;r<t.length;r++)n("#blockedSitesList").append(this.addBlockedSiteToListHTML(t[r],"blacklist-"+r)),function(t,r){n("#"+r+" img").click(function(){e.removeFromList(t,r,"black")})}(t[r],"blacklist-"+r);bg().StayFocusd.isProductivityBypassActive()&&n(".hideOnBypass").hide()},addBlockedSiteToListHTML:function(e,t){var n="";return n+='<li id="'+t+'" class="domain">',n+='<img src="common/img/remove_10x10.png" class="hideOnBypass" title="'+chrome.i18n.getMessage("removeSiteFromBlockedSitesList",e)+'" alt="'+chrome.i18n.getMessage("removeFromList")+'">',n+=e,n+="</li>",n},initAllowedSites:function(){var e=this;bg().NuclearOption.isActive()?(n("#newAllowedSites").val(chrome.i18n.getMessage("cannotAddAllowedSitesDuringNuclearOption")),n("#newAllowedSites").attr("disabled","disabled"),n("#newAllowedSites").addClass("disabled"),n("input[name=addAllowedSites]").attr("disabled","disabled")):(n("#newAllowedSites").val(""),n("#newAllowedSites").attr("disabled",!1),n("#newAllowedSites").removeClass("disabled"),n("input[name=addAllowedSites]").attr("disabled",!1),n("input[name=addAllowedSites]").click(function(){e.addAllowedSites()})),this.createAllowedSitesListHTML()},addAllowedSites:function(){n("#allowedNoSitesYet").remove();var e=n("#newAllowedSites").val();if(e!==""){var t=e.split("\n");for(var r=0;r<t.length;r++){var i=t[r];if(i.length==0)continue;bg().ListManager.addToWhitelist(i)}this.createBlockedSitesListHTML(),this.createAllowedSitesListHTML(),n("#newAllowedSites").val("")}},createAllowedSitesListHTML:function(){n("#allowedSitesList").html("");var e=this,t=bg().ListManager.getWhitelistedDomains();if(t.length===0)n("#allowedSitesList").append('<li id="allowedNoSitesYet"><i>'+chrome.i18n.getMessage("noSitesYet")+"</i></li>");else for(var r=0;r<t.length;r++){var i='<li id="whitelist-'+r+'" class="domain">';i+='<img src="common/img/remove_10x10.png" title="'+chrome.i18n.getMessage("removeSiteFromAllowedSitesList",t[r])+'" alt="'+chrome.i18n.getMessage("removeFromList")+'">'+t[r],i+="</li>",n("#allowedSitesList").append(i),function(t,r){n("#"+r+" img").click(function(){e.removeFromList(t,r,"white")})}(t[r],"whitelist-"+r)}},setNuclearOption:function(){if(n("#nuclearOptionForm input[name=blockLength]").val()=="0")return alert(chrome.i18n.getMessage("greaterThanZero")),!1;var e=confirm(this.getNuclearOptionConfirmationMsg());if(e){var t={};t.blockType=n("#nuclearOptionForm input[name=blockType]:checked").val(),t.contentType=n("#nuclearOptionForm input[name=contentType]:checked").val(),t.smartBomb={multimedia:n("#nuclearOptionForm input[name=multimedia]").attr("checked"),forms:n("#nuclearOptionForm input[name=forms]").attr("checked"),logins:n("#nuclearOptionForm input[name=logins]").attr("checked"),images:n("#nuclearOptionForm input[name=images]").attr("checked")},t.blockLength=parseFloat(n("#nuclearOptionForm input[name=blockLength]").val()),t.startType=n("#nuclearOptionForm input[name=startType]:checked").val(),t.frequency=n("#nuclearOptionForm input[name=frequency]:checked").val(),t.startHour=null,t.startMin=null,t.startAmPm=null,t.startType=="atScheduledTime"&&(t.startHour=n("#nuclearOptionForm select[name=startHour]").val(),t.startMin=n("#nuclearOptionForm select[name=startMin]").val(),t.startAmPm=n("#nuclearOptionForm select[name=startAmPm]").val()),bg().NuclearOption.saveSettings(t),t.startType=="now"&&bg().NuclearOption.activate(),this.initNuclearOption(),this.initAllowedSites(),alert(chrome.i18n.getMessage("commencingNuclearOption"))}},getNuclearOptionConfirmationMsg:function(){var e=n("#nuclearOptionForm select[name=startHour]").val(),r=n("#nuclearOptionForm select[name=startMin]").val(),i=n("#nuclearOptionForm select[name=startAmPm]").val(),s=n("#nuclearOptionForm input[name=contentType]:checked").val(),o=chrome.i18n.getMessage("stayFocusdWillBlock")+" ";if(s=="smartBomb"){var u=n("#nuclearOptionForm input[name=multimedia]").attr("checked"),a=n("#nuclearOptionForm input[name=forms]").attr("checked"),f=n("#nuclearOptionForm input[name=images]").attr("checked"),l=n("#nuclearOptionForm input[name=logins]").attr("checked"),c=[];u&&c.push(chrome.i18n.getMessage("multimedia")),a&&c.push(chrome.i18n.getMessage("forms")),l&&c.push(chrome.i18n.getMessage("logins")),f&&c.push(chrome.i18n.getMessage("images")),o+=c.join("/")+" "+chrome.i18n.getMessage("for")+" "}o+=n("#nuclearOptionForm input[name=blockType]:checked + label").text(),o+=" "+chrome.i18n.getMessage("forTime")+" "+n("#nuclearOptionForm input[name=blockLength]").val()+" "+chrome.i18n.getMessage("hourOrMore"),o+=" "+chrome.i18n.getMessage("startingTime")+" ";var h=n("#nuclearOptionForm input[name=startType]:checked").val();switch(h){case"now":o+=chrome.i18n.getMessage("rightNow");break;case"whenMaxTimeAllowedExceeded":o+=chrome.i18n.getMessage("whenMaxTimeExceeded");break;case"atScheduledTime":o+=chrome.i18n.getMessage("atTime")+" ",o+=e=="00"?"12":e,o+=":"+r,o+=" "+i.toUpperCase()}var p=n("#nuclearOptionForm input[name=frequency]:checked").val(),d=(new Date).getDay(),v=p!="everyWeekday"||d>0&&d<6;return h=="now"?o+=".":o+=v?" "+chrome.i18n.getMessage("today")+".":" "+chrome.i18n.getMessage("onMonday")+".",h=="atScheduledTime"&&t.hasTimePassed(e,r,i)&&v?o+="\n\n"+chrome.i18n.getMessage("selectedTimeHasPassed")+" "+chrome.i18n.getMessage("nuclearOptionImmediately"):h=="whenMaxTimeAllowedExceeded"&&bg().StayFocusd.isMaxTimeAllowedExceeded()&&(o+="\n\n"+chrome.i18n.getMessage("maxTimeHasBeenExceeded")+" "+chrome.i18n.getMessage("nuclearOptionImmediately")),o+="\n\n"+chrome.i18n.getMessage("areYouSure"),o},initNuclearOption:function(e){var r=this;e===!0&&(n("#activateNuclearOptionButton").click(function(){r.setNuclearOption()}),n("#nuclearOptionForm input[name=blockLength]").keydown(function(e){r.allowOnlyNumbers(e,!0)}),n("#nuclearOptionForm input[name=startType]").click(function(){n(this).val()=="atScheduledTime"?n("#nuclearOptionScheduledTime").show():n("#nuclearOptionScheduledTime").hide(),n(this).val()=="now"?n("#nuclearOptionFrequency").hide():n("#nuclearOptionFrequency").show()}),n("#nuclearOptionForm input[name=contentType]").click(function(){n(this).val()=="smartBomb"?n("#smartBombOptions").show():n("#smartBombOptions").hide()})),this.setNuclearOptionDefaults();if(bg().NuclearOption.isActive()){this.restrictNuclearOptionSettings();var i=bg().NuclearOption.getExpiration();i=t.timestampToDisplayDate(i);var s=i.hours+":"+i.minutes+" "+i.ampm+" on "+i.month+"/"+i.day+"/"+i.year;n("#nuclearOptionMsg").html(chrome.i18n.getMessage("nuclearOptionActiveUntil")+" "+s+"."),n("#nuclearOptionMsg").show()}},restrictNuclearOptionSettings:function(){this.disallowMoreLenientNuclearOption("blockType","all","allExceptAllowed","blocked"),this.disallowMoreLenientNuclearOption("contentType","wholeSite","smartBomb",null),this.disallowMoreLenientNuclearOption("startType","now","whenMaxTimeAllowedExceeded","atScheduledTime"),this.disallowMoreLenientNuclearOption("frequency","everyDay","everyWeekday","todayOnly"),n("#nuclearOptionForm input[name=blockLength]").change(function(){var e=bg().NuclearOption.settings.blockLength;if(e!==undefined&&n(this).val()<e)return alert(chrome.i18n.getMessage("cannotChooseMoreLenientSetting")),n(this).val(e),!1}),n("#nuclearOptionForm input[value=atScheduledTime]").attr("checked")&&n("#nuclearOptionScheduledTime select").attr("disabled","disabled")},disallowMoreLenientNuclearOption:function(e,t,r,i){var s=function(){return alert(chrome.i18n.getMessage("cannotChooseMoreLenientSetting")),!1},o=n("#nuclearOptionForm input[name="+e+"]:checked").val();i!==null&&o!==i&&n("#nuclearOptionForm input[value="+i+"]").click(s),o===t&&n("#nuclearOptionForm input[value="+r+"]").click(s)},setNuclearOptionDefaults:function(){var e=bg().NuclearOption,t=e.getBlockType();n("#nuclearOptionForm input[value="+t+"]").attr("checked","checked");var r=e.getContentType();n("#nuclearOptionForm input[value="+r+"]").attr("checked","checked"),r=="smartBomb"?n("#smartBombOptions").show():n(".smartBombOption").attr("checked","checked");var i=e.getSmartBomb();for(var s in i)i.hasOwnProperty(s)&&i[s]==="checked"&&n("#nuclearOptionForm input[value="+s+"]").attr("checked","checked");var o=e.getBlockLength();n("#nuclearOptionForm input[name=blockLength]").val(o);var u=e.getStartType();n("#nuclearOptionForm input[value="+u+"]").attr("checked","checked");var a=e.getFrequency();n("#nuclearOptionForm input[value="+a+"]").attr("checked","checked");if(u=="atScheduledTime"){var f=e.getStartHour(),l=e.getStartMin(),c=e.getStartAmPm();n("#nuclearOptionForm select[name=startHour]").val(f),n("#nuclearOptionForm select[name=startMin]").val(l),n("#nuclearOptionForm select[name=startAmPm]").val(c),n("#nuclearOptionScheduledTime").show()}u=="now"?n("#nuclearOptionFrequency").hide():n("#nuclearOptionFrequency").show()},allowOnlyNumbers:function(e,t){(t!==!0||e.keyCode!=190&&e.keyCode!=110)&&e.keyCode!=46&&e.keyCode!=8&&(e.keyCode<48||e.keyCode>57&&(e.keyCode<96||e.keyCode>105))&&e.preventDefault()},initChallenge:function(){var e=this;bg().StayFocusd.clearProductivityBypass(),n("#customChallenge").val(e.getChallengeText()),n("#productivityBypass").click(function(){e.initProductivityBypass()}),n("#requireChallenge").click(function(){e.setChallengeRequired(n(this))}),this.isChallengeRequired()&&n("#requireChallenge").attr("checked","checked"),n("#challengeText").keydown(function(t){switch(t.keyCode){case 8:return!1;case 9:return!1;case 16:return!1;case 17:return!1;case 18:return!1;case 20:return!1;case 45:return!1;case 46:return!1}e.challengeKeyCounter++}),n("#challengeText").keyup(function(t){switch(t.keyCode){case 8:return!1;case 9:return!1;case 16:return!1;case 17:return!1;case 18:return!1;case 20:return!1;case 45:return!1;case 46:return!1}var r=n("#challengeSource").html(),i=n(this).val();if(e.challengeKeyCounter<i.length)return alert(chrome.i18n.getMessage("numberOfKeysDoesNotMatch")),e.resetChallenge(),!1;var s=r.substring(0,i.length),o=["s","b","p","a","y"],u=o[1]+o[4]+o[2]+o[3]+o[0]+o[0],a=u.substring(0,i.length);if(i!=s&&i!=a)return alert(chrome.i18n.getMessage("madeAMistake")),e.resetChallenge(),!1;if(i.length==r.length||i==u)n.modal.close(),e.resetChallenge()}),this.isChallengeRequired()&&this.showChallenge()},getChallengeText:function(){var e=bg().StayFocusd.getLocal("challengeText");return e=unescape(e),e.length<this.getMinChallengeTextLength()&&(e=this.defaultChallengeText),e},setChallengeText:function(e){var t=this.getMinChallengeTextLength();if(e.length<t)return alert(chrome.i18n.getMessage("challengeTextTooShort",t.toString())),!1;var r=[];for(var i=0;i<e.length;i++){var s=e.charAt(i);r.inArray(s)||r.push(s)}if(r.length<5)return alert(chrome.i18n.getMessage("notEnoughVariation")),!1;e=e.split("\n").join(" "),e=e.split("\r").join(" "),e=e.split("	").join(" "),e=e.replace(/ +(?= )/g,""),n("#customChallenge").val(e),e=escape(e),bg().StayFocusd.setLocal("challengeText",e),alert(chrome.i18n.getMessage("challengeTextSet"))},resetChallengeText:function(){this.setChallengeText(this.defaultChallengeText)},getMinChallengeTextLength:function(){var e=unescape(this.defaultChallengeText);return e.length},resetChallenge:function(){n("#challengeText").val(""),n("#challengeText").focus(),this.challengeKeyCounter=0},setChallengeRequired:function(e){if(e.attr("checked")){var t=confirm(chrome.i18n.getMessage("confirmRequireChallenge"));t?bg().StayFocusd.setLocal("challengeRequired","true"):e.attr("checked","")}else bg().StayFocusd.setLocal("challengeRequired","false")},showChallenge:function(){var e=this;return n("#challengeContainer").modal({opacity:80,overlayId:"overlay",escClose:!1}),n("#challengeSource").html(e.getChallengeText()),!1},isChallengeRequired:function(){return bg().StayFocusd.getLocal("challengeRequired")=="true"},initProductivityBypass:function(){bg().StayFocusd.setProductivityBypass(),n("li.option:not(li.option.bypass)").hide(),n("li.option:not(li.option.bypass)").html(""),n("#nav li:not(li.bypass)").hide(),n(".hideOnBypass").hide(),this.selectNav("maxTimeAllowed"),n.modal.close()},initCustomizeInterface:function(){var e=this;chrome.storage.onChanged.addListener(function(t,n){console.log(n+" storage changed",t),bg().ListManager.loadBlacklist(e.createBlockedSitesListHTML.bind(e)),bg().ListManager.loadWhitelist(e.createAllowedSitesListHTML.bind(e))}),n("#disableSync").click(function(){e.toggleDisableSync()}),this.isSyncDisabled()&&n("#disableSync").attr("checked","checked"),n("#hideAllowSiteLink").click(function(){e.toggleAllowSiteLink()}),this.isAllowSiteLinkHidden()&&n("#hideAllowSiteLink").attr("checked","checked"),n("#hideInfoBar").click(function(){e.toggleInfoBar()}),this.isInfoBarHidden()&&n("#hideInfoBar").attr("checked","checked"),n("#disableActivityMonitor").click(function(){e.toggleActivityMonitor()}),n("#disableUpdatePopup").click(function(){e.toggleUpdatePopup()}),bg().StayFocusd.isActivityMonitorDisabled()&&n("#disableActivityMonitor").attr("checked","checked"),bg().StayFocusd.isUpdatePopupDisabled()&&n("#disableUpdatePopup").attr("checked","checked"),n("input[name=setCustomChallenge]").click(function(){var t=n("#customChallenge").val();e.setChallengeText(t)}),n("#minChallengeTextLength").html(e.getMinChallengeTextLength()),n("#resetCustomChallenge").click(function(){e.resetChallengeText()});var t=bg().Notification.get();this.setNotificationOptionDefaults(t),n("#customNotifications input").keydown(function(t){e.allowOnlyNumbers(t)}),n("#customNotifications input").keydown(function(t){e.allowOnlyNumbers(t)}),n("#saveNotificationsButton").click(function(){e.saveNotifications()})},saveNotifications:function(){var e=[];for(var t=0;t<5;t++){var r=n("#customNotifications input[name=value"+t+"]").val();if(r.length==0)continue;var i=n("#customNotifications select[name=unit"+t+"]").val();r=parseFloat(r),r=i=="min"?r*60:r,e.push(r)}bg().Notification.saveSettings(e),alert(chrome.i18n.getMessage("notificationSettingsSaved"))},setNotificationOptionDefaults:function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=parseInt(e[t]);if(isNaN(r))continue;var i=r>59?r/60:r,s=r>59?"min":"sec";n("#customNotifications input[name=value"+t+"]").val(i),n("#customNotifications select[name=unit"+t+"]").val(s)}},toggleDisableSync:function(){if(this.isSyncDisabled()){var e=this;bg().StayFocusd.setLocal("disableSync","false"),bg().ListManager.mergeLocalWithSynced(function(){e.createBlockedSitesListHTML(),e.createAllowedSitesListHTML()})}else bg().StayFocusd.setLocal("disableSync","true")},isSyncDisabled:function(){return bg().StayFocusd.getLocal("disableSync")=="true"},toggleAllowSiteLink:function(){this.isAllowSiteLinkHidden()?bg().StayFocusd.setLocal("hideAllowSiteLink","false"):bg().StayFocusd.setLocal("hideAllowSiteLink","true")},isAllowSiteLinkHidden:function(){return bg().StayFocusd.getLocal("hideAllowSiteLink")=="true"},toggleInfoBar:function(){this.isInfoBarHidden()?bg().StayFocusd.setLocal("hideInfoBar","false"):bg().StayFocusd.setLocal("hideInfoBar","true")},isInfoBarHidden:function(){return bg().StayFocusd.getLocal("hideInfoBar")==="true"},toggleActivityMonitor:function(){bg().StayFocusd.isActivityMonitorDisabled()?bg().StayFocusd.setLocal("disableActivityMonitor","false"):bg().StayFocusd.setLocal("disableActivityMonitor","true")},toggleUpdatePopup:function(){bg().StayFocusd.isUpdatePopupDisabled()?bg().StayFocusd.setLocal("disableUpdatePopup","false"):bg().StayFocusd.setLocal("disableUpdatePopup","true")},initImportExport:function(){var e=this;n("#exportSettings").click(function(){e.exportSettings()}),bg().StayFocusd.isMaxTimeAllowedExceeded()?(n("#importSettings").attr("disabled","disabled"),n("#importSettingsMsg").html(chrome.i18n.getMessage("cannotImportAfterTimeExpired")),n("#importSettingsMsg").show()):n("#importSettings").click(function(){e.importSettings()})},getSettings:function(){var e={};for(var t=0,n=localStorage.length;t<n;t++){var r=localStorage.key(t);e[r]=localStorage[r]}return e},exportSettings:function(){var e=this.getSettings(),t=document.createElement("form"),n=document.createElement("input");t.setAttribute("method","POST"),t.setAttribute("action",bg().StayFocusd.apiURL+"/export.php"),n.setAttribute("type","hidden"),n.setAttribute("name","settings"),n.setAttribute("value",encodeURIComponent(JSON.stringify(e))),t.appendChild(n),t.submit()},importSettings:function(){var e=document.getElementById("settingsFile").files,t=this;if(!(e instanceof FileList&&e.length!==0))return alert(chrome.i18n.getMessage("mustSelectSettingsFile")),!1;var n=new FileReader;n.onloadend=function(e){return function(e){t.saveImportedSettings(e.target.result)}}(e[0]),n.readAsText(e[0])},saveImportedSettings:function(e){n("#importedSettings ul").html(""),n("#importedSettings").show();try{var t=JSON.parse(decodeURIComponent(e)),r={},i=!1;for(var s in t)if(t.hasOwnProperty(s)){bg().StayFocusd.setLocal(s,t[s]);if(s.indexOf("sync_")===0){var o=s.substring(5);r[o]=JSON.parse(t[s]),i=!0}n("#importedSettings ul").append("<li><b>"+s+":</b><br />"+t[s]+"</li>")}i&&bg().ListManager.setSynced(r),n("#importedSettings").append('<h4 class="success">'+chrome.i18n.getMessage("done").toUpperCase()+"!</h4>"),n("#importedSettings").append("<p>"+chrome.i18n.getMessage("refreshToSeeImportedSettings")+"</p>"),bg().location.href="background.html"}catch(u){n("#importedSettings").html('<h4 class="error">'+chrome.i18n.getMessage("problemImportingSettings")+"</h4>"),n("#importedSettings").append("<p>"+chrome.i18n.getMessage("canOnlyImportExportedFile")+"</p>"),n("#importedSettings").append("<p>"+chrome.i18n.getMessage("importEmailSupport")+"<p>")}}};return i}),Array.prototype.inArray=function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]==e)return!0;return!1};